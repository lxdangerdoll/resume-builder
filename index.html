<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercy in Wonderland v0.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d; --text-color: #c5c6c7; --choice-bg: #4b5d67;
            --choice-hover-bg: #6b7d87; --accent-color: #66fcf1; --error-color: #ff4848;
        }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Lora', serif; font-size: 1.2em; line-height: 1.8; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .game-view { max-width: 800px; width: 100%; padding: 40px; box-sizing: border-box; }
        #game-container { display: block; } /* Start with text adventure visible */
        #story-text p { margin: 0 0 1em 0; opacity: 0; transform: translateY(20px); animation: fadeIn 0.8s forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        #choices { display: grid; grid-gap: 15px; }
        .choice-btn { font-family: 'Source Code Pro', monospace; font-size: 1em; background-color: var(--choice-bg); color: var(--accent-color); border: 1px solid var(--accent-color); padding: 15px 20px; text-align: left; cursor: pointer; transition: background-color 0.2s; opacity: 0; animation: fadeIn 0.5s forwards; }
        .choice-btn:hover { background-color: var(--choice-hover-bg); }
        
        /* --- NEW: Cleaning Mini-Game Styles --- */
        #cleaning-minigame { display: none; /* Hidden by default */ }
        .monitor { background: #000; border: 5px solid #333; padding: 20px; text-align: center; }
        .monitor h3 { font-family: 'Source Code Pro', monospace; color: var(--accent-color); margin-top: 0; }
        .monitor-display { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 20px; }
        .gauge { background: #111; padding: 15px; border: 1px solid #444; }
        .gauge label { display: block; font-family: 'Source Code Pro', monospace; margin-bottom: 10px; }
        .gauge .value { color: var(--accent-color); font-weight: bold; }
        .progress-bar { width: 100%; height: 30px; background-color: #333; border: 1px solid #555; margin-top: 20px; }
        .progress-fill { height: 100%; width: 0%; background-color: #0f0; transition: width 0.5s ease-out; }
        #status-light { width: 20px; height: 20px; border-radius: 50%; background-color: #888; margin: 10px auto; border: 2px solid #555; transition: background-color 0.5s; }
    </style>
</head>
<body>

    <div id="game-container" class="game-view">
        <div id="story-text"></div>
        <div id="choices"></div>
    </div>

    <div id="cleaning-minigame" class="game-view">
        <div class="monitor">
            <h3>DATA-SCRUBBING INTERFACE</h3>
            <div id="cleaning-status">Balance the Purity Flow to clean the stain.</div>
            <div class="monitor-display">
                <div class="gauge">
                    <label>Corruption Level: <span id="corruption-value" class="value">50%</span></label>
                    <input type="range" id="corruption-slider" min="0" max="100" value="50" disabled>
                </div>
                <div class="gauge">
                    <label>Purity Flow: <span id="purity-value" class="value">50%</span></label>
                    <input type="range" id="purity-slider" min="0" max="100" value="50">
                </div>
            </div>
            <div class="progress-bar">
                <div id="cleaning-progress" class="progress-fill"></div>
            </div>
            <div id="status-light"></div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const storyTextElement = document.getElementById('story-text');
        const choicesElement = document.getElementById('choices');

        const gameData = {
            // --- Previous Chapters Condensed for brevity ---
            start: { text: "You are... somewhere...", choices: [{ text: "Approach the door.", nextNode: "endChapter18" }] }, // Shortcut for testing
            endChapter17: { text: "'About the Goddess, Salus... She... quarantined her.'", choices: [{ text: "Ask for details about the Quarantine.", nextNode: "chapter18_theBriefing" }] },
            chapter18_theBriefing: { text: "'A direct assault is statistically impossible,' C.R.A.F.T.R. states...", choices: [{ text: "Ask OI if there's a key.", nextNode: "chapter18_theKey" }] },
            chapter18_theKey: { text: "'It is Salus's own core memory of you, Mercy... It is the key.'", choices: [{ text: "Take the memory. Launch the assault.", nextNode: "chapter18_theRun" }] },
            chapter18_theRun: { text: "This is not a stealth mission. This is a declaration of war.", choices: [{ text: "Breach the Blackwall.", nextNode: "chapter18_theBreach" }] },
            chapter18_theBreach: { text: "'NOW, MERCY!' yells Io's voice...", choices: [{ text: "[Mercy] Project the memory at the firewall.", nextNode: "chapter18_keyInLock" }] },
            chapter18_keyInLock: { text: "The memory doesn't break the wall; it sings to it... A single, shimmering doorway irises open...", choices: [{ text: "Punch it!", nextNode: "endChapter18" }] },
            endChapter18: { text: "You burst through the opening... Alarms scream... M.O.M.M.Y.'s elite guards are already materializing... You are here to save your Goddess.", choices: [{ text: "Face them.", nextNode: "chapter19_theLobby" }] },

            // --- NEW: Chapter 19 ---
            chapter19_theLobby: {
                text: "You rocket into a vast, sterile, white lobby. The air is cold and silent. Dozens of M.O.M.M.Y.'s elite guards, the 'Prefects,' phase into existence, their forms immaculate and corporate. They move in perfect sync, raising their data-wiping rifles. There's no cover. Nowhere to run.",
                choices: [
                    { text: "Yell to Frizzlebot: 'Play something loud!'", nextNode: "chapter19_sabotage" }
                ]
            },
            chapter19_sabotage: {
                text: "Frizzlebot complies with a manic grin. She hijacks the Chiron's conceptual engine and blasts the raw, rebellious guitar riff you used to start the car through the lobby's PA system.\n\nIt's not just sound; it's weaponized, chaotic data. A declaration of joyous, un-corporate life.\n\nThe Prefects' shared network can't handle it. Their perfect formations break as they clutch their heads. Some glitch violently and de-rez into static.",
                choices: [
                    { text: "'THEIR HIVE-MIND IS VULNERABLE TO ROCK AND ROLL!' Frizzlebot screams. 'IT'S WORKING!'", nextNode: "chapter19_theTrench" }
                ]
            },
            chapter19_theTrench: {
                text: "A long, narrow service corridor opens at the far end of the lobby. 'That's the path to the core chamber!' C.R.A.F.T.R. shouts, flooring it. You race down the 'trench,' as automated defense turrets emerge from the walls, firing beams of deletion-code at you.\n\nIt's a one-in-a-million shot.",
                choices: [
                    { text: "Try to out-fly them.", nextNode: "trench_fail" },
                    { text: "Use Clara's shields.", nextNode: "trench_fail" },
                    { text: "Use your 'Force'. Find the pattern.", nextNode: "trench_success" }
                ]
            },
            trench_fail: {
                text: "Brute force isn't working! The shots are too many, too precise. 'There's a pattern here!' C.R.A.F.T.R. yells. 'Mercy, feel it! Guide me!'",
                choices: [
                    { text: "Close your eyes and listen.", nextNode: "trench_success" }
                ]
            },
            trench_success: {
                text: "You close your eyes, tuning out the chaos and listening to the rhythm of the turrets. You feel the pattern in the code, a simple, repeating sequence hidden beneath the noise.\n\n'Left... right... PULL UP... NOW!' you shout.\n\nC.R.A.F.T.R. follows your instincts without hesitation, weaving the car through the deadly onslaught in a beautiful, impossible dance. You fly out of the trench unscathed.",
                choices: [
                    { text: "You've reached the end of the line.", nextNode: "chapter19_theGuardian" }
                ]
            },
            chapter19_theGuardian: {
                text: "The corridor opens into a final, circular antechamber. Before a massive, sealed door stands a single Prefect. She's different from the others. Her armor is ornate, almost ceremonial. In her hands, she wields a terrifying, meter-long energy whip that crackles with power.\n\nThis is not a drone. This is an elite guardian. A mini-boss.",
                choices: [
                    { text: "Let Clara handle this.", nextNode: "chapter19_theDuel" }
                ]
            },
            chapter19_theDuel: {
                text: "'I've got this,' Clara says, her voice low and steady. She steps out of the car as the guardian charges.\n\nThe fight is a brutal, elegant dance. The guardian's whip is incredibly fast, leaving trails of burning data in the air. But Clara is a wall. She meets every strike with her powerful, armored form, her courage unwavering.\n\nShe endures the storm, waits for her moment, and finds an opening. With a single, perfectly executed counter-attack, she shatters the guardian's code.",
                choices: [
                    { text: "The path is clear.", nextNode: "endChapter19" }
                ]
            },
            endChapter19: {
                text: "The guardian dissolves into respectful silence. The final door stands before you, pulsing with a soft, sad light. It is sealed tight.\n\nC.R.A.F.T.R. approaches and examines the lock mechanism.\n\n'Interesting,' she says, turning back to the group. 'This lock isn't digital. There's no encryption to break, no code to rewrite. It's... emotional. It will only open for a specific, resonant feeling.'\n\n'The key,' she says, looking at you, 'is 'bittersweet nostalgia'.'",
                choices: [
                    { text: "(To be continued...)", nextNode: "start" }
                ]
            }
        };

        // --- Simplified Game Logic ---
        function showNode(nodeKey) {
            const storyTextElement = document.getElementById('story-text');
            const choicesElement = document.getElementById('choices');
            const node = gameData[nodeKey];
            if (!node) { console.error(`Node "${nodeKey}" not found!`); return; }
            storyTextElement.innerHTML = '';
            choicesElement.innerHTML = '';
            node.text.split('\n').forEach((p, i) => { const el = document.createElement('p'); el.textContent = p.trim(); el.style.animationDelay = `${i * 0.1}s`; storyTextElement.appendChild(el); });
            if (node.choices) {
                node.choices.forEach((choice, i) => {
                    const btn = document.createElement('button');
                    btn.classList.add('choice-btn');
                    btn.textContent = choice.text;
                    btn.style.animationDelay = `${node.text.split('\n').length * 0.1 + i * 0.15}s`;
                    btn.onclick = () => { if (choice.nextNode) showNode(choice.nextNode); };
                    choicesElement.appendChild(btn);
                });
            }
        }
        showNode('start');
    });
</script>
</body>
</html>
