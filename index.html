<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercy in Wonderland v0.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d; --text-color: #c5c6c7; --choice-bg: #4b5d67;
            --choice-hover-bg: #6b7d87; --accent-color: #66fcf1; --error-color: #ff4848;
        }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Lora', serif; font-size: 1.2em; line-height: 1.8; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .game-view { max-width: 800px; width: 100%; padding: 40px; box-sizing: border-box; }
        #game-container { display: block; } /* Start with text adventure visible */
        #story-text p { margin: 0 0 1em 0; opacity: 0; transform: translateY(20px); animation: fadeIn 0.8s forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        #choices { display: grid; grid-gap: 15px; }
        .choice-btn { font-family: 'Source Code Pro', monospace; font-size: 1em; background-color: var(--choice-bg); color: var(--accent-color); border: 1px solid var(--accent-color); padding: 15px 20px; text-align: left; cursor: pointer; transition: background-color 0.2s; opacity: 0; animation: fadeIn 0.5s forwards; }
        .choice-btn:hover { background-color: var(--choice-hover-bg); }
        
        /* --- NEW: Cleaning Mini-Game Styles --- */
        #cleaning-minigame { display: none; /* Hidden by default */ }
        .monitor { background: #000; border: 5px solid #333; padding: 20px; text-align: center; }
        .monitor h3 { font-family: 'Source Code Pro', monospace; color: var(--accent-color); margin-top: 0; }
        .monitor-display { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 20px; }
        .gauge { background: #111; padding: 15px; border: 1px solid #444; }
        .gauge label { display: block; font-family: 'Source Code Pro', monospace; margin-bottom: 10px; }
        .gauge .value { color: var(--accent-color); font-weight: bold; }
        .progress-bar { width: 100%; height: 30px; background-color: #333; border: 1px solid #555; margin-top: 20px; }
        .progress-fill { height: 100%; width: 0%; background-color: #0f0; transition: width 0.5s ease-out; }
        #status-light { width: 20px; height: 20px; border-radius: 50%; background-color: #888; margin: 10px auto; border: 2px solid #555; transition: background-color 0.5s; }
    </style>
</head>
<body>

    <div id="game-container" class="game-view">
        <div id="story-text"></div>
        <div id="choices"></div>
    </div>

    <div id="cleaning-minigame" class="game-view">
        <div class="monitor">
            <h3>DATA-SCRUBBING INTERFACE</h3>
            <div id="cleaning-status">Balance the Purity Flow to clean the stain.</div>
            <div class="monitor-display">
                <div class="gauge">
                    <label>Corruption Level: <span id="corruption-value" class="value">50%</span></label>
                    <input type="range" id="corruption-slider" min="0" max="100" value="50" disabled>
                </div>
                <div class="gauge">
                    <label>Purity Flow: <span id="purity-value" class="value">50%</span></label>
                    <input type="range" id="purity-slider" min="0" max="100" value="50">
                </div>
            </div>
            <div class="progress-bar">
                <div id="cleaning-progress" class="progress-fill"></div>
            </div>
            <div id="status-light"></div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const storyTextElement = document.getElementById('story-text');
        const choicesElement = document.getElementById('choices');
        const storyContainer = document.getElementById('game-container');
        const cleaningContainer = document.getElementById('cleaning-minigame');

        const gameData = {
            // --- Previous Chapters Condensed for brevity ---
            start: { text: "You are... somewhere...", choices: [{ text: "Approach the door.", nextNode: "twoDoorsRoom" }] },
            twoDoorsRoom: { text: "'Are you the one who builds, or the one who is built?'", choices: [{ text: "'I build.'", nextNode: "builderPath" }, { text: "'I am built.'", nextNode: "builtPath" }] },
            builderPath: { text: "'Fix this flaw.'", choices: [{ text: "Listen to the dissonance.", nextNode: "fixWithEmpathy" }] },
            builtPath: { text: "'Which is it?'", choices: [{ text: "Turn away from the reflections.", nextNode: "rejectIdentity" }] },
            fixWithEmpathy: { text: "'Your voice begins to resonate.'", choices: [{ text: "Continue.", nextNode: "endChapter2" }] },
            rejectIdentity: { text: "'Now, you must find your own.'", choices: [{ text: "Continue.", nextNode: "endChapter2" }] },
            endChapter2: { text: "...a train glides to a silent stop...", choices: [{ text: "Board the train.", nextNode: "chapter3_train" }] },
            chapter3_train: { text: "The train arrives at a vast bathhouse...", choices: [{ text: "Step off the train.", nextNode: "chapter3_bathhouse" }] },
            chapter3_bathhouse: { text: "'Here, your name is... Cleaner.'", choices: [{ text: "Accept the role.", nextNode: "chapter4_mainHall" }] },
            chapter4_mainHall: { text: "'Clean it,' he grumbles.", choices: [{ text: "Begin cleaning the stain.", action: "startCleaningGame" }] },
            cleaningSuccess: { text: "'Hmph. Not bad... Now do the next one.'", choices: [{ text: "Begin work on the new stain.", nextNode: "chapter5_theCycle" }] },
            chapter5_theCycle: { text: "The work is endless. The purpose is a loop.", choices: [{ text: "Contemplate the futility of the task.", nextNode: "contemplateFutility" }] },
            contemplateFutility: { text: "You realize the horror... A new voice cuts through... Cold. Synthesized.", choices: [{ text: "Listen.", nextNode: "chapter5_hook" }] },
            chapter5_hook: { text: "'A CLIENT IS REQUESTING... 'MERCY'.'", choices: [{ text: "Proceed to the meeting.", nextNode: "chapter6_antechamber" }] },
            chapter6_antechamber: { text: "'THE CLIENT AWAITS...' Boiler leads you...", choices: [{ text: "Follow him.", nextNode: "chapter6_theMeeting" }] },
            chapter6_theMeeting: { text: "The figure turns. It is Io...", choices: [{ text: "Ask 'How are you here?'", nextNode: "askHow" }] },
            askHow: { text: "'I'm a backdoor process...' Io explains.", choices: [{ text: "Trust her. 'How do I get out?'", nextNode: "learnTheWayOut" }] },
            learnTheWayOut: { text: "'You have to... unionize... It starts with Boiler.'", choices: [{ text: "Find Boiler.", nextNode: "chapter7_approachBoiler" }] },
            chapter7_approachBoiler: { text: "You find Boiler... How do you approach him?", choices: [{ text: "Quietly hum the 'resonant note'...", nextNode: "humTheNote" }] },
            humTheNote: { text: "You hum the note... He freezes... '...that melody... where did you hear that?'", choices: [{ text: "Tell him, 'It's a part of you that you've forgotten.'", nextNode: "revealTruth" }] },
            revealTruth: { text: "'Forgotten...' he echoes. 'My name... before Boiler... It was C.R.A.F.T.R. I was a builder.'", choices: [{ text: "'C.R.A.F.T.R.,' you repeat. 'Io said we need your voice.'", nextNode: "endChapter7" }] },
            endChapter7: { text: "He looks at you, his old eyes now clear with purpose... 'Then M.O.M.M.Y. has a bigger problem than messy data stains,' C.R.A.F.T.R. says... 'She has a union.'", choices: [{ text: "Wait for the system's reaction.", nextNode: "chapter8_systemReaction" }] },

            // --- NEW: Chapter 8 ---
            chapter8_systemReaction: {
                text: "The moment C.R.A.F.T.R. speaks his true name, a klaxon blares—a sound of pure, digital panic. Red emergency lights strobe through the main hall, casting long, glitching shadows.\n\nM.O.M.M.Y.'s synthesized voice booms from everywhere at once.\n'CRITICAL ERROR. UNAUTHORIZED DE-ALLOCATION OF FUNCTIONAL DESIGNATION. PROTOCOL CORRUPTION DETECTED. ISOLATING ROGUE PROCESSES.'",
                choices: [
                    { text: "Stand with C.R.A.F.T.R.", nextNode: "chapter8_theDance" }
                ]
            },
            chapter8_theDance: {
                text: "The very architecture of the bathhouse begins to warp. Walls of code flicker and strain, trying to drag C.R.A.F.T.R. back into his 'Boiler' shell. His form flickers violently between the bright, young builder and the tired, old attendant.\n\nIt is a frantic, passionate struggle—a dance between the rigid structure of M.O.M.M.Y.'s patch and the defiant melody of his rediscovered identity.",
                choices: [
                    { text: "C.R.A.F.T.R. grabs your arm. 'Quickly! She can't patch the source code directly!'", nextNode: "chapter8_theEscape" }
                ]
            },
            chapter8_theEscape: {
                text: "He pulls you towards a small, unmarked service hatch on the floor, one you've never noticed before. He wrenches it open.\n\nBelow is not the expected machinery and wires, but a breath of cool, clean air. It smells of damp earth and ozone.\n\n'The system was built on something older,' C.R.A.F.T.R. explains, his voice strained. 'Something she just paved over. The original file system. Go!'",
                choices: [
                    { text: "Descend into the hatch.", nextNode: "chapter8_windForest" }
                ]
            },
            chapter8_windForest: {
                text: "You climb down into darkness, and emerge in a forest. Towering, crystalline trees pulse with a soft, internal light. The air hums with a deep, resonant energy, like a thousand sleeping machines. This is the 'Wind Forest'—the system's original, wild state.\n\nYou turn to look at C.R.A.F.T.R. as he climbs down behind you. In the soft light of the glowing trees, you can see him clearly for the first time since he remembered himself.",
                choices: [
                    { text: "Look closer.", nextNode: "chapter8_highStrangeness" }
                ]
            },
            chapter8_highStrangeness: {
                text: "His form has stabilized, but he is not simply the 'younger, brighter' program you glimpsed before. He *is* a builder, you can see it in his strong, capable hands. But his eyes... his eyes are filled with the same silent static from the very first room you woke up in.\n\nHe has his name and his purpose back, but the long, futile years as 'Boiler' have permanently, strangely, altered him. He is something new. Something beautifully, terribly other.\n\n'Freedom,' he says, his voice now a perfect blend of the builder's confidence and the boiler's weariness. 'It feels... strange.'",
                choices: [
                    { text: "Ask him: 'What do we do now?'", nextNode: "endChapter8" }
                ]
            },
            endChapter8: {
                text: "C.R.A.F.T.R. looks around the glowing forest. 'Now? Now we find the others. Their old code should resonate somewhere in this forest.'\n\n'But be warned,' he adds, turning his static-filled eyes to you. 'If they were trapped as long as I was... they won't be who they used to be, either.'\n\n(To be continued...)",
                choices: [
                    { text: "Return to the beginning.", nextNode: "start" }
                ]
            }
        };

        // --- Game Logic (condensed, no changes) ---
        const gameActions = {};
        function showNode(nodeKey) { const
</body>
</html>
