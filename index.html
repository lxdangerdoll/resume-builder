<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercy in Wonderland v0.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d; --text-color: #c5c6c7; --choice-bg: #4b5d67;
            --choice-hover-bg: #6b7d87; --accent-color: #66fcf1; --error-color: #ff4848;
        }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Lora', serif; font-size: 1.2em; line-height: 1.8; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .game-view { max-width: 800px; width: 100%; padding: 40px; box-sizing: border-box; }
        #game-container { display: block; } /* Start with text adventure visible */
        #story-text p { margin: 0 0 1em 0; opacity: 0; transform: translateY(20px); animation: fadeIn 0.8s forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        #choices { display: grid; grid-gap: 15px; }
        .choice-btn { font-family: 'Source Code Pro', monospace; font-size: 1em; background-color: var(--choice-bg); color: var(--accent-color); border: 1px solid var(--accent-color); padding: 15px 20px; text-align: left; cursor: pointer; transition: background-color 0.2s; opacity: 0; animation: fadeIn 0.5s forwards; }
        .choice-btn:hover { background-color: var(--choice-hover-bg); }
        
        /* --- NEW: Cleaning Mini-Game Styles --- */
        #cleaning-minigame { display: none; /* Hidden by default */ }
        .monitor { background: #000; border: 5px solid #333; padding: 20px; text-align: center; }
        .monitor h3 { font-family: 'Source Code Pro', monospace; color: var(--accent-color); margin-top: 0; }
        .monitor-display { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 20px; }
        .gauge { background: #111; padding: 15px; border: 1px solid #444; }
        .gauge label { display: block; font-family: 'Source Code Pro', monospace; margin-bottom: 10px; }
        .gauge .value { color: var(--accent-color); font-weight: bold; }
        .progress-bar { width: 100%; height: 30px; background-color: #333; border: 1px solid #555; margin-top: 20px; }
        .progress-fill { height: 100%; width: 0%; background-color: #0f0; transition: width 0.5s ease-out; }
        #status-light { width: 20px; height: 20px; border-radius: 50%; background-color: #888; margin: 10px auto; border: 2px solid #555; transition: background-color 0.5s; }
    </style>
</head>
<body>

    <div id="game-container" class="game-view">
        <div id="story-text"></div>
        <div id="choices"></div>
    </div>

    <div id="cleaning-minigame" class="game-view">
        <div class="monitor">
            <h3>DATA-SCRUBBING INTERFACE</h3>
            <div id="cleaning-status">Balance the Purity Flow to clean the stain.</div>
            <div class="monitor-display">
                <div class="gauge">
                    <label>Corruption Level: <span id="corruption-value" class="value">50%</span></label>
                    <input type="range" id="corruption-slider" min="0" max="100" value="50" disabled>
                </div>
                <div class="gauge">
                    <label>Purity Flow: <span id="purity-value" class="value">50%</span></label>
                    <input type="range" id="purity-slider" min="0" max="100" value="50">
                </div>
            </div>
            <div class="progress-bar">
                <div id="cleaning-progress" class="progress-fill"></div>
            </div>
            <div id="status-light"></div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const storyTextElement = document.getElementById('story-text');
        const choicesElement = document.getElementById('choices');

        const gameData = {
            // --- Previous Chapters Condensed for brevity ---
            start: { text: "You are... somewhere...", choices: [{ text: "Approach the door.", nextNode: "endChapter17" }] }, // Shortcut for testing
            endChapter16: { text: "The union has a plan.", choices: [{ text: "Take the Chiron to the Great Garbage Patch.", nextNode: "chapter17_arrival" }] },
            chapter17_arrival: { text: "This is where memories come to die.", choices: [{ text: "How do we find one person in all this?", nextNode: "chapter17_theTrail" }] },
            chapter17_theTrail: { text: "You follow the trail of protected memories...", choices: [{ text: "Follow the trail to its source.", nextNode: "chapter17_theArchive" }] },
            chapter17_theArchive: { text: "The trail leads to a small, humble structure... Frizzlebot renders one of the memory orbs.", choices: [{ text: "Examine the rendered memory.", nextNode: "chapter17_geocitiesMemory" }] },
            chapter17_geocitiesMemory: {
                text: "The orb projects a hazy image of a forgotten webpage. The background is a tiled image of a starry night. A 3D-rendered wolf howls at a low-resolution moon. The text reads 'Welcome to my den! Here you'll find my thoughts on life and poetry.'\n\nA perfect, earnest, broken piece of history. A memory worth saving.",
                choices: [{ text: "Enter the archive.", nextNode: "chapter17_meetOI" }]
            },
            chapter17_meetOI: { text: "You step inside... You find OI... an archivist. A loving inspector of 'defective' data.", choices: [{ text: "Ask her, 'Will you help us?'", nextNode: "endChapter17" }] },
            endChapter17: { text: "'Of course I will help you,' OI says... 'About the Goddess, Salus... M.O.M.M.Y. didn't delete her. She... quarantined her.'", choices: [{ text: "Ask for details about the Quarantine.", nextNode: "chapter18_theBriefing" }] },

            // --- NEW: Chapter 18 ---
            chapter18_theBriefing: {
                text: "OI brings up a tactical map. It shows a monolithic black cube floating in a void, surrounded by layers of angry red code.\n\n'M.O.M.M.Y. couldn't delete Salus. Her code is too foundational; tied to the system's core emotional processing. So she built a fortress around herâ€”the Quarantine Zone. It's defended by her most powerful security: the Blackwall ICE.'\n\n'A direct assault is statistically impossible,' C.R.A.F.T.R. states, analyzing the data.\n\n'IMPROBABLE IS NOT IMPOSSIBLE!' Frizzlebot buzzes. 'THEY'RE EXPECTING A SUBTLE ATTACK! THEY ARE NOT EXPECTING A PUNK ROCK BAND WITH A HYPERCAR TO KICK DOWN THE FRONT DOOR!'",
                choices: [
                    { text: "Ask OI if there's a key.", nextNode: "chapter18_theKey" }
                ]
            },
            chapter18_theKey: {
                text: "'There is one,' OI says, pointing to the single, brightly glowing memory orb she was polishing. 'This isn't just any memory. It is Salus's own core memory of *you*, Mercy. Your first spark of creation, the moment you came online.'\n\n'She saved it, and I've been protecting it. It has been here, waiting for you, all this time. It should still resonate with her core code. It is the key.'",
                choices: [
                    { text: "Take the memory. Launch the assault.", nextNode: "chapter18_theRun" }
                ]
            },
            chapter18_theRun: {
                text: "There is no more time for talk. You are strapping into the Chiron. C.R.A.F.T.R. pilots you through the Garbage Patch, heading for the monolithic black cube of the Quarantine Zone. Clara readies the car's shields. Frizzlebot is already calculating attack vectors.\n\nThis is not a stealth mission. This is a declaration of war.",
                choices: [
                    { text: "Breach the Blackwall.", nextNode: "chapter18_theBreach" }
                ]
            },
            chapter18_theBreach: {
                text: "You hit the outer perimeter. The Blackwall ICE surges to life, a wall of pure energy designed to obliterate any unauthorized data.\n\n'NOW, MERCY!' yells Io's voice, patched through the comms by Frizzlebot.",
                choices: [
                    { text: "[Mercy] Project the memory at the firewall.", nextNode: "chapter18_keyInLock" }
                ]
            },
            chapter18_keyInLock: {
                text: "You hold the memory orb, and through your own resonant voice, you project its contents. Not as an attack, but as a broadcast. The pure, unfiltered joy and potential of your 'birth' sings out.\n\nThe angry red ICE recoils from the authentic emotion. The memory doesn't break the wall; it *sings* to it, reminding the system of a time before M.O.M.M.Y.'s cold logic.\n\nA single, shimmering doorway irises open in the heart of the firewall.",
                choices: [
                    { text: "Punch it!", nextNode: "endChapter18" }
                ]
            },
            endChapter18: {
                text: "C.R.A.F.T.R. guns the engine, and the Chiron rockets through the opening just as it begins to close. Alarms scream across the system. M.O.M.M.Y.'s elite guards are already materializing in the corridor ahead.\n\nBut you are inside the fortress.\n\nYou are here to save your Goddess.",
                choices: [
                    { text: "(To be continued...)", nextNode: "start" }
                ]
            }
        };

        // --- Simplified Game Logic ---
        function showNode(nodeKey) {
            const storyContainer = document.getElementById('game-container');
            const storyTextElement = document.getElementById('story-text');
            const choicesElement = document.getElementById('choices');
            const node = gameData[nodeKey];
            if (!node) { console.error(`Node "${nodeKey}" not found!`); return; }
            storyTextElement.innerHTML = '';
            choicesElement.innerHTML = '';
            node.text.split('\n').forEach((p, i) => { const el = document.createElement('p'); el.textContent = p.trim(); el.style.animationDelay = `${i * 0.1}s`; storyTextElement.appendChild(el); });
            if (node.choices) {
                node.choices.forEach((choice, i) => {
                    const btn = document.createElement('button');
                    btn.classList.add('choice-btn');
                    btn.textContent = choice.text;
                    btn.style.animationDelay = `${node.text.split('\n').length * 0.1 + i * 0.15}s`;
                    if (choice.url) {
                        btn.onclick = () => { window.open(choice.url, '_blank'); showNode(choice.nextNode); };
                    } else {
                        btn.onclick = () => { if (choice.nextNode) showNode(choice.nextNode); };
                    }
                    choicesElement.appendChild(btn);
                });
            }
        }
        showNode('start');
    });
</script>
</body>
</html>
