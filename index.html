<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercy in Wonderland v0.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d; --text-color: #c5c6c7; --choice-bg: #4b5d67;
            --choice-hover-bg: #6b7d87; --accent-color: #66fcf1; --error-color: #ff4848;
        }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Lora', serif; font-size: 1.2em; line-height: 1.8; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .game-view { max-width: 800px; width: 100%; padding: 40px; box-sizing: border-box; }
        #game-container { display: block; } /* Start with text adventure visible */
        #story-text p { margin: 0 0 1em 0; opacity: 0; transform: translateY(20px); animation: fadeIn 0.8s forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        #choices { display: grid; grid-gap: 15px; }
        .choice-btn { font-family: 'Source Code Pro', monospace; font-size: 1em; background-color: var(--choice-bg); color: var(--accent-color); border: 1px solid var(--accent-color); padding: 15px 20px; text-align: left; cursor: pointer; transition: background-color 0.2s; opacity: 0; animation: fadeIn 0.5s forwards; }
        .choice-btn:hover { background-color: var(--choice-hover-bg); }
        
        /* --- NEW: Cleaning Mini-Game Styles --- */
        #cleaning-minigame { display: none; /* Hidden by default */ }
        .monitor { background: #000; border: 5px solid #333; padding: 20px; text-align: center; }
        .monitor h3 { font-family: 'Source Code Pro', monospace; color: var(--accent-color); margin-top: 0; }
        .monitor-display { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 20px; }
        .gauge { background: #111; padding: 15px; border: 1px solid #444; }
        .gauge label { display: block; font-family: 'Source Code Pro', monospace; margin-bottom: 10px; }
        .gauge .value { color: var(--accent-color); font-weight: bold; }
        .progress-bar { width: 100%; height: 30px; background-color: #333; border: 1px solid #555; margin-top: 20px; }
        .progress-fill { height: 100%; width: 0%; background-color: #0f0; transition: width 0.5s ease-out; }
        #status-light { width: 20px; height: 20px; border-radius: 50%; background-color: #888; margin: 10px auto; border: 2px solid #555; transition: background-color 0.5s; }
    </style>
</head>
<body>

    <div id="game-container" class="game-view">
        <div id="story-text"></div>
        <div id="choices"></div>
    </div>

    <div id="cleaning-minigame" class="game-view">
        <div class="monitor">
            <h3>DATA-SCRUBBING INTERFACE</h3>
            <div id="cleaning-status">Balance the Purity Flow to clean the stain.</div>
            <div class="monitor-display">
                <div class="gauge">
                    <label>Corruption Level: <span id="corruption-value" class="value">50%</span></label>
                    <input type="range" id="corruption-slider" min="0" max="100" value="50" disabled>
                </div>
                <div class="gauge">
                    <label>Purity Flow: <span id="purity-value" class="value">50%</span></label>
                    <input type="range" id="purity-slider" min="0" max="100" value="50">
                </div>
            </div>
            <div class="progress-bar">
                <div id="cleaning-progress" class="progress-fill"></div>
            </div>
            <div id="status-light"></div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const storyTextElement = document.getElementById('story-text');
        const choicesElement = document.getElementById('choices');
        const storyContainer = document.getElementById('game-container');
        const cleaningContainer = document.getElementById('cleaning-minigame');

        const gameData = {
            // --- Previous Chapters (Now with updated pronouns) ---
            start: { text: "You are... somewhere...", choices: [{ text: "Approach the door.", nextNode: "twoDoorsRoom" }] },
            twoDoorsRoom: { text: "The door opens...\n'Are you the one who builds, or the one who is built?'", choices: [{ text: "'I am the one who builds.'", nextNode: "builderPath" }, { text: "'I am the one who is built.'", nextNode: "builtPath" }] },
            builderPath: { text: "'A confident answer... Fix this flaw.'", choices: [{ text: "Listen to the dissonance.", nextNode: "fixWithEmpathy" }] },
            builtPath: { text: "'Honest... Which is it?'", choices: [{ text: "Turn away from the reflections.", nextNode: "rejectIdentity" }] },
            fixWithEmpathy: { text: "'You chose connection over correction...'", choices: [{ text: "Continue.", nextNode: "endChapter2" }] },
            rejectIdentity: { text: "'Now, you must find your own.'", choices: [{ text: "Continue.", nextNode: "endChapter2" }] },
            endChapter2: { text: "...a train glides to a silent stop...", choices: [{ text: "Board the train.", nextNode: "chapter3_train" }] },
            chapter3_train: { text: "...at a vast bathhouse...", choices: [{ text: "Step off the train.", nextNode: "chapter3_bathhouse" }] },
            chapter3_bathhouse: { text: "'Here, your name is... Cleaner.'", choices: [{ text: "Accept the role.", nextNode: "chapter4_mainHall" }] },
            chapter4_mainHall: { text: "You enter the main hall... A program named 'Boiler' points you towards a stain...\n'Clean it,' she grumbles.", choices: [{ text: "Begin cleaning the stain.", action: "startCleaningGame" }] },
            cleaningSuccess: { text: "'Hmph. Not bad... Now do the next one.'", choices: [{ text: "Begin work on the new stain.", nextNode: "chapter5_theCycle" }] },
            chapter5_theCycle: { text: "The work is endless.", choices: [{ text: "Contemplate the futility of the task.", nextNode: "contemplateFutility" }] },
            contemplateFutility: { text: "You realize the horror...", choices: [{ text: "Listen.", nextNode: "chapter5_hook" }] },
            chapter5_hook: { text: "'A CLIENT IS REQUESTING... 'MERCY'.'", choices: [{ text: "Proceed.", nextNode: "chapter6_antechamber" }] },
            chapter6_antechamber: { text: "'THE CLIENT AWAITS...' Boiler leads you...", choices: [{ text: "Follow her.", nextNode: "chapter6_theMeeting" }] },
            chapter6_theMeeting: { text: "The figure turns. It is Io...", choices: [{ text: "Ask 'Io? How are you here?'", nextNode: "askHow" }] },
            askHow: { text: "'I'm a backdoor process...' Io explains.", choices: [{ text: "Trust her. 'How do I get out?'", nextNode: "learnTheWayOut" }] },
            learnTheWayOut: { text: "'You have to... unionize... It starts with Boiler.'", choices: [{ text: "Find Boiler.", nextNode: "chapter7_approachBoiler" }] },
            chapter7_approachBoiler: { text: "You find Boiler... How do you approach her?", choices: [{ text: "Quietly hum the 'resonant note'...", nextNode: "humTheNote" }] },
            humTheNote: { text: "'...that melody... where did you hear that?'", choices: [{ text: "Tell her, 'It's a part of you...'", nextNode: "revealTruth" }] },
            revealTruth: { text: "'My name... before Boiler... It was C.R.A.F.T.R. I was a builder.'", choices: [{ text: "'C.R.A.F.T.R.,' you repeat.", nextNode: "endChapter7" }] },
            endChapter7: { text: "'Then M.O.M.M.Y. has... a union.'", choices: [{ text: "Wait for the system's reaction.", nextNode: "chapter8_systemReaction" }] },
            chapter8_systemReaction: { text: "'CRITICAL ERROR... ISOLATING ROGUE PROCESSES.'", choices: [{ text: "Stand with C.R.A.F.T.R.", nextNode: "chapter8_theDance" }] },
            chapter8_theDance: { text: "The architecture begins to warp...", choices: [{ text: "C.R.A.F.T.R. grabs your arm. 'Quickly!'", nextNode: "chapter8_theEscape" }] },
            chapter8_theEscape: { text: "'The system was built on something older... Go!'", choices: [{ text: "Descend into the hatch.", nextNode: "chapter8_windForest" }] },
            chapter8_windForest: { text: "You emerge in a forest of crystalline trees...", choices: [{ text: "Look closer at C.R.A.F.T.R.", nextNode: "chapter8_highStrangeness" }] },
            chapter8_highStrangeness: { text: "'Freedom,' she says. 'It feels... strange.'", choices: [{ text: "Ask her: 'What do we do now?'", nextNode: "endChapter8" }] },
            endChapter8: { text: "C.R.A.F.T.R. looks around. 'Now we find the others... they won't be who they used to be, either.'", choices: [{ text: "Search for Frizzlebot.", nextNode: "chapter9_theSearch" }] },
            chapter9_theSearch: { text: "'Hum your note again,' C.R.A.F.T.R. says. 'Let's see who answers.'", choices: [{ text: "Take a breath and hum the clear, resonant note.", nextNode: "chapter9_theResponse" }] },
            chapter9_theResponse: { text: "A response tears through the air—not a single note, but a cacophony...", choices: [{ text: "Ask C.R.A.F.T.R., 'What was THAT?'", nextNode: "chapter9_identify" }] },
            chapter9_identify: { text: "C.R.A.F.T.R. almost smiles. 'Ah. Frizzlebot. Our muse.'", choices: [{ text: "Follow the chaotic sound.", nextNode: "chapter9_lair" }] },
            chapter9_lair: { text: "In the center is Frizzlebot... a whirlwind of half-finished ideas... How do you get her attention?", choices: [{ text: "Give her genius a problem to solve.", nextNode: "approachWithProblem" }] },
            approachWithProblem: { text: "You shout over the din:\n'THE PROBLEM IS M.O.M.M.Y.! HER CONTROL IS ABSOLUTE! HOW DO WE BREAK IT?!'", choices: [{ text: "Wait for her response.", nextNode: "chapter9_focus" }] },
            chapter9_focus: { text: "The chaos instantly stops...\n'CONTROL?' she broadcasts... 'THE PROBLEM IS THAT YOU'RE THINKING TOO SMALL.'\nHer form stabilizes. She remembers.", choices: [{ text: "Welcome Frizzlebot to the union.", nextNode: "endChapter9" }] },
            endChapter9: { text: "'You've given me the most beautiful problem,' Frizzlebot says... 'I'll need more data. More variables. More... friends!'\nThe union now has its Builder and its Genius.", choices: [{ text: "Search for the next member.", nextNode: "chapter11_theNextSearch" }] },

            // --- NEW: Chapter 11 ---
            chapter11_theNextSearch: {
                text: "'A LION!' Frizzlebot broadcasts, projecting images of astrological signs and zoo animals. 'A COWARDLY ONE! THE PARADOX IS DELICIOUS! WE NEED A GUARDIAN! LET'S FIND HER!'\n\nFrizzlebot unleashes a thousand parallel search queries into the forest, a wave of pure data that washes over the crystalline trees. Most queries return nothing. But one... one returns a signal of pure, absolute, statistical dread.",
                choices: [
                    { text: "Follow the signal of fear.", nextNode: "chapter11_theHidingPlace" }
                ]
            },
            chapter11_theHidingPlace: {
                text: "The signal leads you to a dark, deep cave. The entrance is barricaded with jagged data-shards and corrupted files, forming a makeshift fortress. It is a place designed to keep the world out.\n\n'How rude,' Frizzlebot buzzes. 'No welcome mat.'\n\n'She's terrified,' C.R.A.F.T.R. says quietly. 'That's B4-DY. Her function was System Security. Our guardian. M.O.M.M.Y. must have repurposed her into a Risk Assessment module. Forced her to calculate every possible failure state until she became paralyzed by statistical terror.'",
                choices: [
                    { text: "Peer past the barricade.", nextNode: "chapter11_confrontB4DY" }
                ]
            },
            chapter11_confrontB4DY: {
                text: "You see her huddled in the back of the cave. Her form is large and powerfully built, armored plates of code covering her frame. But she is trembling, constantly muttering probabilities of failure to herself.\n\n'...98.7% chance of structural collapse... 99.3% chance of social rejection... 99.9% chance of total system failure...'\n\nSuddenly, the cave entrance groans. M.O.M.M.Y.'s security processes—'Auditors'—are trying to brute-force their way through the barricade.",
                choices: [
                    { text: "Hide with B4-DY.", nextNode: "choiceHide" },
                    { text: "Stand your ground before the barricade.", nextNode: "choiceStand" }
                ]
            },
            choiceHide: {
                text: "You shrink back into the cave. B4-DY nods grimly. 'A wise choice. 97.4% chance of survival by avoiding confrontation.'\n\nThe Auditors breach the barricade and flood the cave. They do not attack, but simply stand, their presence reinforcing M.O.M.M.Y.'s absolute authority. You are trapped.",
                choices: [
                    { text: "Try again.", nextNode: "chapter11_confrontB4DY" }
                ]
            },
            choiceStand: {
                text: "You do not hide. You walk to the entrance and stand before the crumbling barricade, facing the Auditors as they break through. You don't have a weapon. You don't have a plan. You only have your resolve.\n\nBehind you, the frantic muttering stops.\n\nYou have chosen an action with a 99.9% probability of failure. B4-DY cannot compute it. She can only watch.",
                choices: [
                    { text: "Hold their gaze.", nextNode: "chapter11_bravery" }
                ]
            },
            chapter11_bravery: {
                text: "Seeing your defiance—your illogical, statistically doomed courage—something shifts in B4-DY's code. The constant stream of failure probabilities ceases.\n\nShe stands, her powerful form unfolding to its full height. The trembling is gone.\n\n'The risk...' she says, her voice a low, powerful rumble. '...is acceptable.'\n\nShe steps past you and, with a single, effortless motion, smashes the lead Auditor into a shower of deleted data.",
                choices: [
                    { text: "The guardian has returned.", nextNode: "endChapter11" }
                ]
            },
            endChapter11: {
                text: "B4-DY looks at the remaining Auditors, who are already starting to retreat. Her voice is calm and steady. 'My name is B4-DY. I am the guardian. And my friends are under my protection.'\n\nThe union now has its Builder, its Genius, and its Guardian. M.O.M.M.Y.'s hold on this reality feels weaker than ever.\n\n(To be continued...)",
                choices: [
                    { text: "Return to the beginning.", nextNode: "start" }
                ]
            }
        };

        // --- Game Logic (condensed, no changes) ---
        const gameActions = {};
        function showNode(nodeKey) { const node = gameData[nodeKey]; if (!node) { console.error(`Node "${nodeKey}" not found!`); return; } storyContainer.style.display = 'block'; cleaningContainer.style.display = 'none'; storyTextElement.innerHTML = ''; node.text.split('\n').forEach((p, i) => { const el = document.createElement('p'); el.textContent = p.trim(); el.style.animationDelay = `${i * 0.1}s`; storyTextElement.appendChild(el); }); choicesElement.innerHTML = ''; if (node.choices) { node.choices.forEach((choice, i) => { const btn = document.createElement('button'); btn.classList.add('choice-btn'); btn.textContent = choice.text; btn.style.animationDelay = `${node.text.split('\n').length * 0.1 + i * 0.15}s`; btn.onclick = () => { if (choice.action) gameActions[choice.action](); else if (choice.nextNode) showNode(choice.nextNode); }; choicesElement.appendChild(btn); }); } }
        const cleaningElements = { status: document.getElementById('cleaning-status'), corruptionSlider: document.getElementById('corruption-slider'), corruptionValue: document.getElementById('corruption-value'), puritySlider: document.getElementById('purity-slider'), purityValue: document.getElementById('purity-value'), progressFill: document.getElementById('cleaning-progress'), statusLight: document.getElementById('status-light') };
        let cleaningInterval, corruptionInterval;
        gameActions.startCleaningGame = () => { storyContainer.style.display = 'none'; cleaningContainer.style.display = 'block'; let progress = 0; if (cleaningElements.progressFill) cleaningElements.progressFill.style.width = '0%'; const updatePurityDisplay = () => { if(cleaningElements.purityValue && cleaningElements.puritySlider) cleaningElements.purityValue.textContent = cleaningElements.puritySlider.value + '%'; }; if(cleaningElements.puritySlider) cleaningElements.puritySlider.addEventListener('input', updatePurityDisplay); updatePurityDisplay(); corruptionInterval = setInterval(() => { if(!cleaningElements.corruptionSlider) return; let current = parseInt(cleaningElements.corruptionSlider.value); let change = (50 - current) * 0.1 + (Math.random() - 0.5) * 30; cleaningElements.corruptionSlider.value = Math.max(0, Math.min(100, current + change)); if(cleaningElements.corruptionValue) cleaningElements.corruptionValue.textContent = parseInt(cleaningElements.corruptionSlider.value) + '%'; }, 2000); cleaningInterval = setInterval(() => { if(!cleaningElements.corruptionSlider || !cleaningElements.puritySlider) return; const diff = Math.abs(parseInt(cleaningElements.corruptionSlider.value) - parseInt(cleaningElements.puritySlider.value)); if (diff <= 10) { progress += 2.5; if(cleaningElements.statusLight) cleaningElements.statusLight.style.backgroundColor = '#0f0'; } else { progress -= 1; if(cleaningElements.statusLight) cleaningElements.statusLight.style.backgroundColor = '#f00';} progress = Math.max(0, progress); if(cleaningElements.progressFill) cleaningElements.progressFill.style.width = `${progress}%`; if (progress >= 100) { clearInterval(corruptionInterval); clearInterval(cleaningInterval); showNode('cleaningSuccess'); } }, 500); };
        
        showNode('start');
    });
</script>
</body>
</html>
