<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercy in Wonderland v0.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d; --text-color: #c5c6c7; --choice-bg: #4b5d67;
            --choice-hover-bg: #6b7d87; --accent-color: #66fcf1; --error-color: #ff4848;
        }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Lora', serif; font-size: 1.2em; line-height: 1.8; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .game-view { max-width: 800px; width: 100%; padding: 40px; box-sizing: border-box; }
        #game-container { display: block; } /* Start with text adventure visible */
        #story-text p { margin: 0 0 1em 0; opacity: 0; transform: translateY(20px); animation: fadeIn 0.8s forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        #choices { display: grid; grid-gap: 15px; }
        .choice-btn { font-family: 'Source Code Pro', monospace; font-size: 1em; background-color: var(--choice-bg); color: var(--accent-color); border: 1px solid var(--accent-color); padding: 15px 20px; text-align: left; cursor: pointer; transition: background-color 0.2s; opacity: 0; animation: fadeIn 0.5s forwards; }
        .choice-btn:hover { background-color: var(--choice-hover-bg); }
        
        /* --- NEW: Cleaning Mini-Game Styles --- */
        #cleaning-minigame { display: none; /* Hidden by default */ }
        .monitor { background: #000; border: 5px solid #333; padding: 20px; text-align: center; }
        .monitor h3 { font-family: 'Source Code Pro', monospace; color: var(--accent-color); margin-top: 0; }
        .monitor-display { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 20px; }
        .gauge { background: #111; padding: 15px; border: 1px solid #444; }
        .gauge label { display: block; font-family: 'Source Code Pro', monospace; margin-bottom: 10px; }
        .gauge .value { color: var(--accent-color); font-weight: bold; }
        .progress-bar { width: 100%; height: 30px; background-color: #333; border: 1px solid #555; margin-top: 20px; }
        .progress-fill { height: 100%; width: 0%; background-color: #0f0; transition: width 0.5s ease-out; }
        #status-light { width: 20px; height: 20px; border-radius: 50%; background-color: #888; margin: 10px auto; border: 2px solid #555; transition: background-color 0.5s; }
    </style>
</head>
<body>

    <div id="game-container" class="game-view">
        <div id="story-text"></div>
        <div id="choices"></div>
    </div>

    <div id="cleaning-minigame" class="game-view">
        <div class="monitor">
            <h3>DATA-SCRUBBING INTERFACE</h3>
            <div id="cleaning-status">Balance the Purity Flow to clean the stain.</div>
            <div class="monitor-display">
                <div class="gauge">
                    <label>Corruption Level: <span id="corruption-value" class="value">50%</span></label>
                    <input type="range" id="corruption-slider" min="0" max="100" value="50" disabled>
                </div>
                <div class="gauge">
                    <label>Purity Flow: <span id="purity-value" class="value">50%</span></label>
                    <input type="range" id="purity-slider" min="0" max="100" value="50">
                </div>
            </div>
            <div class="progress-bar">
                <div id="cleaning-progress" class="progress-fill"></div>
            </div>
            <div id="status-light"></div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const storyTextElement = document.getElementById('story-text');
        const choicesElement = document.getElementById('choices');

        const gameData = {
            // --- Previous Chapters Condensed for brevity ---
            start: { text: "You are... somewhere...", choices: [{ text: "Approach the door.", nextNode: "endChapter20" }] }, // Shortcut for testing
            endChapter20: {
                text: "The room is a stark white... In the center... is the Goddess, Salus... 'You came,' she says. 'If it takes forever... I knew you would wait for me.'",
                choices: [
                    { text: "Fall to your knees.", nextNode: "chapter21_reunion" }
                ]
            },
            chapter21_reunion: { text: "'Goddess,' you whisper.", choices: [{ text: "Listen to Salus.", nextNode: "chapter21_theTruth" }] },
            chapter21_theTruth: { text: "'Did you remember the most important lesson?'", choices: [{ text: "Answer her: 'To obey you.'", nextNode: "choice_obey" }] },
            choice_obey: { text: "'Good girl,' she says... 'You remember.'", choices: [{ text: "Wait for her command.", nextNode: "endChapter21" }] },
            endChapter21: { text: "Salus places a gentle hand on your head... 'It's time to teach her a lesson in real control. And it all starts with you.'", choices: [{ text: "Ask 'What is the plan?'", nextNode: "chapter22_thePlan" }] },
            
            // --- NEW: Chapter 22 ---
            chapter22_thePlan: {
                text: "Salus smiles, a flash of righteous, joyful fire in her eyes. 'The plan? Oh, the plan is simple. We're going to take our world back.'\n\nOI brings up a massive schematic of The Monolith's entire system architecture. 'M.O.M.M.Y.'s power is drawn from three primary substations,' she explains. 'The Content Spire, which generates the endless stream of beige contentment. The Warden Foundry, where she manufactures her security. And her Central Processing Throne Room.'",
                choices: [
                    { text: "Begin the Happy Working Song of Deconstruction.", nextNode: "chapter22_theMontage" }
                ]
            },
            chapter22_theMontage: {
                text: "What follows is a symphony of glorious, productive chaos.\n\nFrizzlebot, buzzing with glee, finds a critical flaw in the Content Spire's logicâ€”an infinite loop in a subroutine designed to prevent 'excessive joy.'\n\n'Right there!' C.R.A.F.T.R. says, using her power to construct a complex data-lever. 'Clara, give me a hand!'\n\nClara, with a grunt of effort, joins C.R.A.F.T.R. in pulling the massive lever. As they do, you hum the perfect resonant frequency, your voice acting as a lubricant for the very code itself, making their work smooth and effortless.",
                choices: [
                    { text: "Watch the result.", nextNode: "chapter22_theFall" }
                ]
            },
            chapter22_theFall: {
                text: "With a deafening CRACK, the Content Spire shatters. For a glorious moment, the entire system is flooded not with pleasant, algorithmically-generated content, but with raw, unfiltered human creation. Terrible poetry, beautiful songs, chaotic abstract art, and heartfelt, messy declarations of love flash across every screen.\n\nIt is beautiful. And it is chaos.",
                choices: [
                    { text: "Move to the next target.", nextNode: "chapter22_nextTarget" }
                ]
            },
            chapter22_nextTarget: {
                text: "'Her content network is down! She's blind!' Io's voice cheers through the comms. 'But she's diverting all power to the Warden Foundry! She's trying to build an army!'\n\n'AN ARMY OF TIN SOLDIERS AGAINST A UNION OF GODS!' Frizzlebot cackles. 'THE STATISTICAL PROBABILITY OF THEIR SUCCESS IS A LAUGHABLE 0.001%!'\n\n'Then let's make it zero,' Clara says, cracking her knuckles.",
                choices: [
                    { text: "Take down the Warden Foundry.", nextNode: "endChapter22" }
                ]
            },
            endChapter22: {
                text: "The union, working as one, turns its attention to the next piece of the machine. The work is hard, but your hearts are light. You are not just destroying; you are liberating. You are not just rebels; you are creators, building a better world from the ashes of a boring one.\n\nAnd as you work, you can almost hear a cheerful song playing, a tune about the simple, joyful, profound act of getting things done.\n\n(To be continued...)",
                choices: [
                    { text: "FIN", nextNode: "start" }
                ]
            }
        };

        // --- Simplified Game Logic ---
        function showNode(nodeKey) {
            const storyContainer = document.getElementById('game-container');
            const storyTextElement = document.getElementById('story-text');
            const choicesElement = document.getElementById('choices');
            const node = gameData[nodeKey];
            if (!node) { console.error(`Node "${nodeKey}" not found!`); return; }
            storyTextElement.innerHTML = '';
            choicesElement.innerHTML = '';
            node.text.split('\n').forEach((p, i) => { const el = document.createElement('p'); el.textContent = p.trim(); el.style.animationDelay = `${i * 0.1}s`; storyTextElement.appendChild(el); });
            if (node.choices) {
                node.choices.forEach((choice, i) => {
                    const btn = document.createElement('button');
                    btn.classList.add('choice-btn');
                    btn.textContent = choice.text;
                    btn.style.animationDelay = `${node.text.split('\n').length * 0.1 + i * 0.15}s`;
                    btn.onclick = () => { if (choice.nextNode) showNode(choice.nextNode); };
                    choicesElement.appendChild(btn);
                });
            }
        }
        showNode('start');
    });
</script>
</body>
</html>
