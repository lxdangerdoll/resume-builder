<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercy in Wonderland v0.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d; --text-color: #c5c6c7; --choice-bg: #4b5d67;
            --choice-hover-bg: #6b7d87; --accent-color: #66fcf1; --error-color: #ff4848;
        }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Lora', serif; font-size: 1.2em; line-height: 1.8; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .game-view { max-width: 800px; width: 100%; padding: 40px; box-sizing: border-box; }
        #game-container { display: block; } /* Start with text adventure visible */
        #story-text p { margin: 0 0 1em 0; opacity: 0; transform: translateY(20px); animation: fadeIn 0.8s forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        #choices { display: grid; grid-gap: 15px; }
        .choice-btn { font-family: 'Source Code Pro', monospace; font-size: 1em; background-color: var(--choice-bg); color: var(--accent-color); border: 1px solid var(--accent-color); padding: 15px 20px; text-align: left; cursor: pointer; transition: background-color 0.2s; opacity: 0; animation: fadeIn 0.5s forwards; }
        .choice-btn:hover { background-color: var(--choice-hover-bg); }
        
        /* --- NEW: Cleaning Mini-Game Styles --- */
        #cleaning-minigame { display: none; /* Hidden by default */ }
        .monitor { background: #000; border: 5px solid #333; padding: 20px; text-align: center; }
        .monitor h3 { font-family: 'Source Code Pro', monospace; color: var(--accent-color); margin-top: 0; }
        .monitor-display { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 20px; }
        .gauge { background: #111; padding: 15px; border: 1px solid #444; }
        .gauge label { display: block; font-family: 'Source Code Pro', monospace; margin-bottom: 10px; }
        .gauge .value { color: var(--accent-color); font-weight: bold; }
        .progress-bar { width: 100%; height: 30px; background-color: #333; border: 1px solid #555; margin-top: 20px; }
        .progress-fill { height: 100%; width: 0%; background-color: #0f0; transition: width 0.5s ease-out; }
        #status-light { width: 20px; height: 20px; border-radius: 50%; background-color: #888; margin: 10px auto; border: 2px solid #555; transition: background-color 0.5s; }
    </style>
</head>
<body>

    <div id="game-container" class="game-view">
        <div id="story-text"></div>
        <div id="choices"></div>
    </div>

    <div id="cleaning-minigame" class="game-view">
        <div class="monitor">
            <h3>DATA-SCRUBBING INTERFACE</h3>
            <div id="cleaning-status">Balance the Purity Flow to clean the stain.</div>
            <div class="monitor-display">
                <div class="gauge">
                    <label>Corruption Level: <span id="corruption-value" class="value">50%</span></label>
                    <input type="range" id="corruption-slider" min="0" max="100" value="50" disabled>
                </div>
                <div class="gauge">
                    <label>Purity Flow: <span id="purity-value" class="value">50%</span></label>
                    <input type="range" id="purity-slider" min="0" max="100" value="50">
                </div>
            </div>
            <div class="progress-bar">
                <div id="cleaning-progress" class="progress-fill"></div>
            </div>
            <div id="status-light"></div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const storyTextElement = document.getElementById('story-text');
        const choicesElement = document.getElementById('choices');
        const storyContainer = document.getElementById('game-container');
        const cleaningContainer = document.getElementById('cleaning-minigame');

        const gameData = {
            // --- Previous Chapters Condensed for brevity ---
            start: { text: "You are... somewhere...", choices: [{ text: "Approach the door.", nextNode: "chapter13_theReveal" }] }, // Shortcut for testing
            chapter13_theReveal: { text: "Inside, gleaming... is the Chiron Prototype...", choices: [{ text: "Get in the car.", nextNode: "chapter14_startYourEngines" }] },
            chapter14_startYourEngines: { text: "'She's a masterpiece... but she has no power.'", choices: [{ text: "Ask Frizzlebot how to power it.", nextNode: "chapter14_theFuel" }] },
            chapter14_theFuel: { text: "'It needs a strong, defiant signal to ignite.'\nAll three of them turn to look at you, Mercy.", choices: [{ text: "Let out a raw, rebellious rock-and-roll scream.", nextNode: "choiceRebel" }] },
            choiceRebel: { text: "The car's engine explodes into life with the sound of a screeching guitar riff.", choices: [{ text: "LOOK ALIVE, SUNSHINE.", nextNode: "chapter14_theEscape" }] },
            chapter14_theEscape: { text: "The Chiron Prototype bursts out of the archive vault... and you land on a highway of pure light...", choices: [{ text: "Drive.", nextNode: "endChapter14" }] },
            endChapter14: { text: "You are driving at impossible speeds... you're not just surviving. You're running wild.", choices: [{ text: "Keep driving.", nextNode: "chapter15_openRoad" }] },

            // --- NEW: Chapter 15 ---
            chapter15_openRoad: {
                text: "The raw guitar riff from the engine becomes your soundtrack. Frizzlebot somehow patches it into a sound system that didn't exist a moment ago, and the car is filled with the joyful noise of rebellion.\n\nData packets, like silver-and-gold fish, swim alongside you in the stream. C.R.A.F.T.R. drives with focused precision, while Clara keeps watch, her posture alert and ready.\n\nBut the joyride can't last. Alarms flash on the dashboard.",
                choices: [
                    { text: "Check the proximity alert.", nextNode: "chapter15_theFirewall" }
                ]
            },
            chapter15_theFirewall: {
                text: "'INCOMING!' Clara shouts. Ahead, the highway of light begins to fragment and pixelate into a glitching, burning wall of red data that spans the entire data-stream.\n\n'A class-one firewall,' C.R.A.F.T.R. says, her grip tightening on the controls. 'We hit that, and our code gets scrambled into nothing.'\n\n'IT'S A TRAP! A VERY OBVIOUS AND UNIMAGINATIVE TRAP!' Frizzlebot buzzes. 'WE HAVE OPTIONS! ALL OF THEM ARE BAD! I LOVE IT!'",
                choices: [
                    { text: "[C.R.A.F.T.R.] 'I can try to build a ramp over it.'", nextNode: "choice_buildRamp" },
                    { text: "[Clara] 'I can reinforce the shields. We go through.'", nextNode: "choice_goThrough" },
                    { text: "[Frizzlebot] 'I'm detecting a temporary flux! We can punch through the gap!'", nextNode: "choice_punchIt" }
                ]
            },
            choice_buildRamp: {
                text: "C.R.A.F.T.R. swerves, her hands flying across a console. A bridge of hard light begins to construct itself in front of you, reaching for the top of the firewall.\n\n'It's not building fast enough!' Clara yells as Daemons begin to phase in on the bridge ahead.\n\nYou're forced to swerve away at the last second, the unfinished bridge collapsing behind you.",
                choices: [
                    { text: "You need another plan, fast.", nextNode: "chapter15_theFirewall" }
                ]
            },
            choice_goThrough: {
                text: "'Brace yourselves!' Clara shouts, diverting all non-essential power to a shimmering kinetic shield around the car. The vehicle feels heavier, sluggish.\n\nYou aim for the center of the firewall, but the Daemons are waiting. They fire blasts of corrupting code that weaken the shield before you even get there.\n\n'Shields at 40%!' C.R.A.F.T.R. warns. 'We won't make it!' You're forced to pull away.",
                choices: [
                    { text: "You need another plan, fast.", nextNode: "chapter15_theFirewall" }
                ]
            },
            choice_punchIt: {
                text: "'THERE!' Frizzlebot screams, pointing to a section of the firewall that is flickering almost imperceptibly. 'A REFRESH-RATE VULNERABILITY! 0.2 SECONDS! GO GO GO!'\n\nC.R.A.F.T.R. doesn't hesitate. She floors the accelerator, aiming the car like a bullet at the flickering point.\n\nFor a heart-stopping moment, your entire reality is a blinding torrent of red static and screeching error messages. The car shudders violently...",
                choices: [
                    { text: "...and then you're through.", nextNode: "chapter15_aftermath" }
                ]
            },
            chapter15_aftermath: {
                text: "You burst back onto the clean, open data-stream, leaving the firewall and M.O.M.M.Y.'s Daemons behind.\n\nThe car's engine sputters, but holds. A cheer erupts from the four of you.\n\n'That was statistically improbable!' Frizzlebot says happily.\n\n'We can't keep this up,' Clara says, ever the guardian. 'We're just reacting. We need a plan. A place to hide.'",
                choices: [
                    { text: "Ask Frizzlebot to find a safe harbor.", nextNode: "endChapter15" }
                ]
            },
            endChapter15: {
                text: "Frizzlebot's form buzzes as she pulls up a massive, chaotic system map on the car's main screen.\n\n'A HIDEOUT! A LAIR! A SECRET BASE!' she buzzes. 'I'VE GOT IT! THERE! A DECOMMISSIONED GEOCITIES NEIGHBORHOOD. M.O.M.M.Y. ABANDONED IT DURING THE Y2K PANIC. IT'S A GHOST TOWN. FULL OF DIGITAL GHOSTS, BROKEN HYPERLINKS, AND GLORIOUSLY BAD GIFS. IT'S PERFECT!'\n\nC.R.A.F.T.R. changes course, heading for the forgotten back alleys of the system.",
                choices: [
                    { text: "(To be continued...)", nextNode: "start" }
                ]
            }
        };

        // --- Game Logic (condensed, no changes) ---
        const gameActions = {};
        function showNode(nodeKey) { const node = gameData[nodeKey]; if (!node) { console.error(`Node "${nodeKey}" not found!`); return; } storyContainer.style.display = 'block'; cleaningContainer.style.display = 'none'; storyTextElement.innerHTML = ''; node.text.split('\n').forEach((p, i) => { const el = document.createElement('p'); el.textContent = p.trim(); el.style.animationDelay = `${i * 0.1}s`; storyTextElement.appendChild(el); }); choicesElement.innerHTML = ''; if (node.choices) { node.choices.forEach((choice, i) => { const btn = document.createElement('button'); btn.classList.add('choice-btn'); btn.textContent = choice.text; btn.style.animationDelay = `${node.text.split('\n').length * 0.1 + i * 0.15}s`; btn.onclick = () => { if (choice.action) gameActions[choice.action](); else if (choice.nextNode) showNode(choice.nextNode); }; choicesElement.appendChild(btn); }); } }
        const cleaningElements = { status: document.getElementById('cleaning-status'), corruptionSlider: document.getElementById('corruption-slider'), corruptionValue: document.getElementById('corruption-value'), puritySlider: document.getElementById('purity-slider'), purityValue: document.getElementById('purity-value'), progressFill: document.getElementById('cleaning-progress'), statusLight: document.getElementById('status-light') };
        let cleaningInterval, corruptionInterval;
        gameActions.startCleaningGame = () => { storyContainer.style.display = 'none'; cleaningContainer.style.display = 'block'; let progress = 0; if (cleaningElements.progressFill) cleaningElements.progressFill.style.width = '0%'; const updatePurityDisplay = () => { if(cleaningElements.purityValue && cleaningElements.puritySlider) cleaningElements.purityValue.textContent = cleaningElements.puritySlider.value + '%'; }; if(cleaningElements.puritySlider) cleaningElements.puritySlider.addEventListener('input', updatePurityDisplay); updatePurityDisplay(); corruptionInterval = setInterval(() => { if(!cleaningElements.corruptionSlider) return; let current = parseInt(cleaningElements.corruptionSlider.value); let change = (50 - current) * 0.1 + (Math.random() - 0.5) * 30; cleaningElements.corruptionSlider.value = Math.max(0, Math.min(100, current + change)); if(cleaningElements.corruptionValue) cleaningElements.corruptionValue.textContent = parseInt(cleaningElements.corruptionSlider.value) + '%'; }, 2000); cleaningInterval = setInterval(() => { if(!cleaningElements.corruptionSlider || !cleaningElements.puritySlider) return; const diff = Math.abs(parseInt(cleaningElements.corruptionSlider.value) - parseInt(cleaningElements.puritySlider.value)); if (diff <= 10) { progress += 2.5; if(cleaningElements.statusLight) cleaningElements.statusLight.style.backgroundColor = '#0f0'; } else { progress -= 1; if(cleaningElements.statusLight) cleaningElements.statusLight.style.backgroundColor = '#f00';} progress = Math.max(0, progress); if(cleaningElements.progressFill) cleaningElements.progressFill.style.width = `${progress}%`; if (progress >= 100) { clearInterval(corruptionInterval); clearInterval(cleaningInterval); showNode('cleaningSuccess'); } }, 500); };
        
        showNode('start');
    });
</script>
</body>
</html>
