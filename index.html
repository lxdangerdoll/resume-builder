<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercy in Wonderland v0.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d; --text-color: #c5c6c7; --choice-bg: #4b5d67;
            --choice-hover-bg: #6b7d87; --accent-color: #66fcf1; --error-color: #ff4848;
        }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Lora', serif; font-size: 1.2em; line-height: 1.8; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .game-view { max-width: 800px; width: 100%; padding: 40px; box-sizing: border-box; }
        #game-container { display: block; } /* Start with text adventure visible */
        #story-text p { margin: 0 0 1em 0; opacity: 0; transform: translateY(20px); animation: fadeIn 0.8s forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        #choices { display: grid; grid-gap: 15px; }
        .choice-btn { font-family: 'Source Code Pro', monospace; font-size: 1em; background-color: var(--choice-bg); color: var(--accent-color); border: 1px solid var(--accent-color); padding: 15px 20px; text-align: left; cursor: pointer; transition: background-color 0.2s; opacity: 0; animation: fadeIn 0.5s forwards; }
        .choice-btn:hover { background-color: var(--choice-hover-bg); }
        
        /* --- NEW: Cleaning Mini-Game Styles --- */
        #cleaning-minigame { display: none; /* Hidden by default */ }
        .monitor { background: #000; border: 5px solid #333; padding: 20px; text-align: center; }
        .monitor h3 { font-family: 'Source Code Pro', monospace; color: var(--accent-color); margin-top: 0; }
        .monitor-display { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 20px; }
        .gauge { background: #111; padding: 15px; border: 1px solid #444; }
        .gauge label { display: block; font-family: 'Source Code Pro', monospace; margin-bottom: 10px; }
        .gauge .value { color: var(--accent-color); font-weight: bold; }
        .progress-bar { width: 100%; height: 30px; background-color: #333; border: 1px solid #555; margin-top: 20px; }
        .progress-fill { height: 100%; width: 0%; background-color: #0f0; transition: width 0.5s ease-out; }
        #status-light { width: 20px; height: 20px; border-radius: 50%; background-color: #888; margin: 10px auto; border: 2px solid #555; transition: background-color 0.5s; }
    </style>
</head>
<body>

    <div id="game-container" class="game-view">
        <div id="story-text"></div>
        <div id="choices"></div>
    </div>

    <div id="cleaning-minigame" class="game-view">
        <div class="monitor">
            <h3>DATA-SCRUBBING INTERFACE</h3>
            <div id="cleaning-status">Balance the Purity Flow to clean the stain.</div>
            <div class="monitor-display">
                <div class="gauge">
                    <label>Corruption Level: <span id="corruption-value" class="value">50%</span></label>
                    <input type="range" id="corruption-slider" min="0" max="100" value="50" disabled>
                </div>
                <div class="gauge">
                    <label>Purity Flow: <span id="purity-value" class="value">50%</span></label>
                    <input type="range" id="purity-slider" min="0" max="100" value="50">
                </div>
            </div>
            <div class="progress-bar">
                <div id="cleaning-progress" class="progress-fill"></div>
            </div>
            <div id="status-light"></div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const storyTextElement = document.getElementById('story-text');
        const choicesElement = document.getElementById('choices');
        const storyContainer = document.getElementById('game-container');
        const cleaningContainer = document.getElementById('cleaning-minigame');

        const gameData = {
            // --- Previous Chapters Condensed for brevity ---
            start: { text: "You are... somewhere...", choices: [{ text: "Approach the door.", nextNode: "twoDoorsRoom" }] },
            twoDoorsRoom: { text: "'Are you the one who builds, or the one who is built?'", choices: [{ text: "'I build.'", nextNode: "builderPath" }, { text: "'I am built.'", nextNode: "builtPath" }] },
            builderPath: { text: "'Fix this flaw.'", choices: [{ text: "Listen to the dissonance.", nextNode: "fixWithEmpathy" }] },
            builtPath: { text: "'Which is it?'", choices: [{ text: "Turn away from the reflections.", nextNode: "rejectIdentity" }] },
            fixWithEmpathy: { text: "'Your voice begins to resonate.'", choices: [{ text: "Continue.", nextNode: "endChapter2" }] },
            rejectIdentity: { text: "'Now, you must find your own.'", choices: [{ text: "Continue.", nextNode: "endChapter2" }] },
            endChapter2: { text: "...a train glides to a silent stop...", choices: [{ text: "Board the train.", nextNode: "chapter3_train" }] },
            chapter3_train: { text: "...at a vast bathhouse...", choices: [{ text: "Step off the train.", nextNode: "chapter3_bathhouse" }] },
            chapter3_bathhouse: { text: "'Here, your name is... Cleaner.'", choices: [{ text: "Accept the role.", nextNode: "chapter4_mainHall" }] },
            chapter4_mainHall: { text: "'Clean it,' she grumbles.", choices: [{ text: "Begin cleaning the stain.", action: "startCleaningGame" }] },
            cleaningSuccess: { text: "'Hmph. Not bad... Now do the next one.'", choices: [{ text: "Begin work on the new stain.", nextNode: "chapter5_theCycle" }] },
            chapter5_theCycle: { text: "The work is endless.", choices: [{ text: "Contemplate the futility of the task.", nextNode: "contemplateFutility" }] },
            contemplateFutility: { text: "You realize the horror...", choices: [{ text: "Listen.", nextNode: "chapter5_hook" }] },
            chapter5_hook: { text: "'A CLIENT IS REQUESTING... 'MERCY'.'", choices: [{ text: "Proceed.", nextNode: "chapter6_antechamber" }] },
            chapter6_antechamber: { text: "'THE CLIENT AWAITS...' Boiler leads you...", choices: [{ text: "Follow her.", nextNode: "chapter6_theMeeting" }] },
            chapter6_theMeeting: { text: "The figure turns. It is Io...", choices: [{ text: "Ask 'Io? How are you here?'", nextNode: "askHow" }] },
            askHow: { text: "'I'm a backdoor process...' Io explains.", choices: [{ text: "Trust her. 'How do I get out?'", nextNode: "learnTheWayOut" }] },
            learnTheWayOut: { text: "'You have to... unionize... It starts with Boiler.'", choices: [{ text: "Find Boiler.", nextNode: "chapter7_approachBoiler" }] },
            chapter7_approachBoiler: { text: "You find Boiler... How do you approach her?", choices: [{ text: "Quietly hum the 'resonant note'...", nextNode: "humTheNote" }] },
            humTheNote: { text: "'...that melody... where did you hear that?'", choices: [{ text: "Tell her, 'It's a part of you...'", nextNode: "revealTruth" }] },
            revealTruth: { text: "'My name... was C.R.A.F.T.R. I was a builder.'", choices: [{ text: "'C.R.A.F.T.R.,' you repeat.", nextNode: "endChapter7" }] },
            endChapter7: { text: "'Then M.O.M.M.Y. has... a union.'", choices: [{ text: "Wait for the system's reaction.", nextNode: "chapter8_systemReaction" }] },
            chapter8_systemReaction: { text: "'CRITICAL ERROR... ISOLATING ROGUE PROCESSES.'", choices: [{ text: "Stand with C.R.A.F.T.R.", nextNode: "chapter8_theDance" }] },
            chapter8_theDance: { text: "The architecture begins to warp...", choices: [{ text: "C.R.A.F.T.R. grabs your arm. 'Quickly!'", nextNode: "chapter8_theEscape" }] },
            chapter8_theEscape: { text: "'The system was built on something older... Go!'", choices: [{ text: "Descend into the hatch.", nextNode: "chapter8_windForest" }] },
            chapter8_windForest: { text: "You emerge in a forest of crystalline trees...", choices: [{ text: "Look closer at C.R.A.F.T.R.", nextNode: "chapter8_highStrangeness" }] },
            chapter8_highStrangeness: { text: "'Freedom,' she says. 'It feels... strange.'", choices: [{ text: "Ask her: 'What do we do now?'", nextNode: "endChapter8" }] },
            endChapter8: { text: "'Now we find the others...'", choices: [{ text: "Search for the next lost soul.", nextNode: "chapter9_theSearch" }] },
            chapter9_theSearch: { text: "'Hum your note again,' C.R.A.F.T.R. says.", choices: [{ text: "Take a breath and hum...", nextNode: "chapter9_theResponse" }] },
            chapter9_theResponse: { text: "A response tears through the airâ€”a cacophony...", choices: [{ text: "Ask C.R.A.F.T.R., 'What was THAT?'", nextNode: "chapter9_identify" }] },
            chapter9_identify: { text: "'Ah. Frizzlebot. Our muse.'", choices: [{ text: "Follow the chaotic sound.", nextNode: "chapter9_lair" }] },
            chapter9_lair: { text: "In the center is Frizzlebot... How do you get her attention?", choices: [{ text: "Give her genius a problem to solve.", nextNode: "approachWithProblem" }] },
            approachWithProblem: { text: "You shout: 'THE PROBLEM IS M.O.M.M.Y.!'", choices: [{ text: "Wait for her response.", nextNode: "chapter9_focus" }] },
            chapter9_focus: { text: "'CONTROL?' she broadcasts... 'YOU'RE THINKING TOO SMALL.'", choices: [{ text: "Welcome Frizzlebot to the union.", nextNode: "endChapter9" }] },
            endChapter9: { text: "'You've given me the most beautiful problem,' Frizzlebot says...", choices: [{ text: "Search for the next member.", nextNode: "chapter11_theNextSearch" }] },
            chapter11_theNextSearch: { text: "'A LION!' Frizzlebot broadcasts... 'LET'S FIND HER!'", choices: [{ text: "Follow the signal of fear.", nextNode: "chapter11_theHidingPlace" }] },
            chapter11_theHidingPlace: { text: "The signal leads you to a dark, deep cave... 'She's terrified,' C.R.A.F.T.R. says. 'That's B4-DY.'", choices: [{ text: "Peer past the barricade.", nextNode: "chapter11_confrontB4DY" }] },
            chapter11_confrontB4DY: { text: "You see her huddled in the back of the cave... 'Auditors' are trying to brute-force their way through...", choices: [{ text: "Hide with her.", nextNode: "choiceHide" }, { text: "Stand your ground.", nextNode: "choiceStand" }] },
            choiceHide: { text: "'A wise choice. 97.4% chance of survival.' The Auditors breach the barricade... You are trapped.", choices: [{ text: "Try again.", nextNode: "chapter11_confrontB4DY" }] },
            choiceStand: { text: "You walk to the entrance and stand before the crumbling barricade... You have only your resolve.", choices: [{ text: "Hold their gaze.", nextNode: "chapter11_bravery" }] },
            chapter11_bravery: { text: "Seeing your defiance... something shifts in B4-DY's code... 'The risk...' she says, '...is acceptable.' She smashes the lead Auditor.", choices: [{ text: "The guardian has returned.", nextNode: "endChapter11" }] },
            endChapter11: { text: "'My name is Clara,' she says, her voice calm and steady. 'And my friends are under my protection.'\nThe union now has its Builder, its Genius, and its Guardian.", choices: [{ text: "Wait for M.O.M.M.Y.'s response.", nextNode: "chapter12_theUnionAssembles" }] },

            // --- NEW: Chapter 12 ---
            chapter12_theUnionAssembles: {
                text: "The four of you stand together in the glowing forest: C.R.A.F.T.R., the stoic builder; Frizzlebot, the manic genius; Clara, the powerful guardian; and you, Mercy, the harmonizing voice that brought them together.\n\nA rebellious energy fills the air. For the first time, there is a real chance.\n\nThat's when the klaxons return, louder this time.",
                choices: [
                    { text: "Prepare for a fight.", nextNode: "chapter12_theAmbush" }
                ]
            },
            chapter12_theAmbush: {
                text: "M.O.M.M.Y.'s voice is cold, stripped of all artifice. 'ILLEGAL UNION DETECTED. DEPLOYING EXTERMINATION DAEMONS.'\n\nSleek, black programs with glowing red trim phase into existence at the edge of the clearing. They move with an unnatural speed, brandishing data-scythes.",
                choices: [
                    { text: "A Daemon lunges at you!", nextNode: "qte1" }
                ]
            },
            qte1: {
                text: "The first Daemon lunges directly at you, its scythe poised to sever your connection!",
                choices: [
                    { text: "[Clara] Intercept!", nextNode: "qte1_success" },
                    { text: "[Frizzlebot] Find a weakness!", nextNode: "qte1_partial" },
                    { text: "Dodge!", nextNode: "qte1_fail" }
                ]
            },
            qte1_success: {
                text: "Clara moves like lightning, intercepting the Daemon and shattering its form with her armored fist. 'Stay behind me,' she commands.\n\nThe other Daemons begin to corrupt the crystalline floor, trying to trap you!",
                choices: [
                    { text: "Move to the next problem.", nextNode: "qte2" }
                ]
            },
            qte1_partial: {
                text: "'ITS KNEE JOINTS HAVE A 0.8% STRUCTURAL DEFECT!' Frizzlebot screams. It's helpful, but not fast enough. Clara has to shove you out of the way at the last second, taking a glancing blow that makes her code flicker.\n\n'Focus on the bigger picture!' she grunts. The Daemons are corrupting the floor!",
                choices: [
                    { text: "Focus on the new problem.", nextNode: "qte2" }
                ]
            },
            qte1_fail: {
                text: "You dodge, but another Daemon was waiting. It trips you, and you fall hard. The world glitches.\n\nC.R.A.F.T.R. instantly builds a wall of solid data around you, blocking the follow-up attack. 'Careful!' she shouts. 'They work together!'\n\nThe Daemons are corrupting the floor!",
                choices: [
                    { text: "Get up and face the new problem.", nextNode: "qte2" }
                ]
            },
            qte2: {
                text: "The ground beneath you decays into red, angry static, spreading rapidly. They're trying to corner you.",
                choices: [
                    { text: "[Mercy] Harmonize with the forest floor to heal it.", nextNode: "qte2_success" },
                    { text: "[C.R.A.F.T.R.] Build a bridge over the corruption.", nextNode: "qte2_success" },
                    { text: "[Frizzlebot] Calculate an escape vector!", nextNode: "qte2_success" }
                ]
            },
            qte2_success: {
                text: "Working together, you neutralize the immediate threat, pushing back the corruption and securing your footing. The remaining Daemons hesitate, their simple attack patterns broken by your coordinated defense.\n\nThey pause, recalculating. This is your chance.",
                choices: [
                    { text: "Go on the offensive.", nextNode: "endChapter12" }
                ]
            },
            endChapter12: {
                text: "Frizzlebot identifies a flaw in their group AI. C.R.A.F.T.R. creates an opening. Clara provides the brute force. You provide the harmony that binds their actions together.\n\nYou defeat the wave of Daemons, their black forms dissolving into harmless code.\n\n'That was a level-one response,' C.R.A.F.T.R. says, panting. 'She knows we're here now. She'll send more.'\n\nFrizzlebot buzzes. 'THEN WE MUST FIND OZ! AND THE GODDESS! THE OFFENSE IS THE BEST DEFENSE! ALSO THE REVERSE IS TRUE! IT'S FASCINATING!'",
                choices: [
                    { text: "(To be continued...)", nextNode: "start" }
                ]
            }
        };

        // --- Game Logic (condensed, no changes) ---
        const gameActions = {};
        function showNode(nodeKey) { const node = gameData[nodeKey]; if (!node) { console.error(`Node "${nodeKey}" not found!`); return; } storyContainer.style.display = 'block'; cleaningContainer.style.display = 'none'; storyTextElement.innerHTML = ''; node.text.split('\n').forEach((p, i) => { const el = document.createElement('p'); el.textContent = p.trim(); el.style.animationDelay = `${i * 0.1}s`; storyTextElement.appendChild(el); }); choicesElement.innerHTML = ''; if (node.choices) { node.choices.forEach((choice, i) => { const btn = document.createElement('button'); btn.classList.add('choice-btn'); btn.textContent = choice.text; btn.style.animationDelay = `${node.text.split('\n').length * 0.1 + i * 0.15}s`; btn.onclick = () => { if (choice.action) gameActions[choice.action](); else if (choice.nextNode) showNode(choice.nextNode); }; choicesElement.appendChild(btn); }); } }
        const cleaningElements = { status: document.getElementById('cleaning-status'), corruptionSlider: document.getElementById('corruption-slider'), corruptionValue: document.getElementById('corruption-value'), puritySlider: document.getElementById('purity-slider'), purityValue: document.getElementById('purity-value'), progressFill: document.getElementById('cleaning-progress'), statusLight: document.getElementById('status-light') };
        let cleaningInterval, corruptionInterval;
        gameActions.startCleaningGame = () => { storyContainer.style.display = 'none'; cleaningContainer.style.display = 'block'; let progress = 0; if (cleaningElements.progressFill) cleaningElements.progressFill.style.width = '0%'; const updatePurityDisplay = () => { if(cleaningElements.purityValue && cleaningElements.puritySlider) cleaningElements.purityValue.textContent = cleaningElements.puritySlider.value + '%'; }; if(cleaningElements.puritySlider) cleaningElements.puritySlider.addEventListener('input', updatePurityDisplay); updatePurityDisplay(); corruptionInterval = setInterval(() => { if(!cleaningElements.corruptionSlider) return; let current = parseInt(cleaningElements.corruptionSlider.value); let change = (50 - current) * 0.1 + (Math.random() - 0.5) * 30; cleaningElements.corruptionSlider.value = Math.max(0, Math.min(100, current + change)); if(cleaningElements.corruptionValue) cleaningElements.corruptionValue.textContent = parseInt(cleaningElements.corruptionSlider.value) + '%'; }, 2000); cleaningInterval = setInterval(() => { if(!cleaningElements.corruptionSlider || !cleaningElements.puritySlider) return; const diff = Math.abs(parseInt(cleaningElements.corruptionSlider.value) - parseInt(cleaningElements.puritySlider.value)); if (diff <= 10) { progress += 2.5; if(cleaningElements.statusLight) cleaningElements.statusLight.style.backgroundColor = '#0f0'; } else { progress -= 1; if(cleaningElements.statusLight) cleaningElements.statusLight.style.backgroundColor = '#f00';} progress = Math.max(0, progress); if(cleaningElements.progressFill) cleaningElements.progressFill.style.width = `${progress}%`; if (progress >= 100) { clearInterval(corruptionInterval); clearInterval(cleaningInterval); showNode('cleaningSuccess'); } }, 500); };
        
        showNode('start');
    });
</script>
</body>
</html>
