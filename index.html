<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercy in Wonderland v0.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d; --text-color: #c5c6c7; --choice-bg: #4b5d67;
            --choice-hover-bg: #6b7d87; --accent-color: #66fcf1; --error-color: #ff4848;
        }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Lora', serif; font-size: 1.2em; line-height: 1.8; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .game-view { max-width: 800px; width: 100%; padding: 40px; box-sizing: border-box; }
        #game-container { display: block; } /* Start with text adventure visible */
        #story-text p { margin: 0 0 1em 0; opacity: 0; transform: translateY(20px); animation: fadeIn 0.8s forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        #choices { display: grid; grid-gap: 15px; }
        .choice-btn { font-family: 'Source Code Pro', monospace; font-size: 1em; background-color: var(--choice-bg); color: var(--accent-color); border: 1px solid var(--accent-color); padding: 15px 20px; text-align: left; cursor: pointer; transition: background-color 0.2s; opacity: 0; animation: fadeIn 0.5s forwards; }
        .choice-btn:hover { background-color: var(--choice-hover-bg); }
        
        /* --- NEW: Cleaning Mini-Game Styles --- */
        #cleaning-minigame { display: none; /* Hidden by default */ }
        .monitor { background: #000; border: 5px solid #333; padding: 20px; text-align: center; }
        .monitor h3 { font-family: 'Source Code Pro', monospace; color: var(--accent-color); margin-top: 0; }
        .monitor-display { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 20px; }
        .gauge { background: #111; padding: 15px; border: 1px solid #444; }
        .gauge label { display: block; font-family: 'Source Code Pro', monospace; margin-bottom: 10px; }
        .gauge .value { color: var(--accent-color); font-weight: bold; }
        .progress-bar { width: 100%; height: 30px; background-color: #333; border: 1px solid #555; margin-top: 20px; }
        .progress-fill { height: 100%; width: 0%; background-color: #0f0; transition: width 0.5s ease-out; }
        #status-light { width: 20px; height: 20px; border-radius: 50%; background-color: #888; margin: 10px auto; border: 2px solid #555; transition: background-color 0.5s; }
    </style>
</head>
<body>

    <div id="game-container" class="game-view">
        <div id="story-text"></div>
        <div id="choices"></div>
    </div>

    <div id="cleaning-minigame" class="game-view">
        <div class="monitor">
            <h3>DATA-SCRUBBING INTERFACE</h3>
            <div id="cleaning-status">Balance the Purity Flow to clean the stain.</div>
            <div class="monitor-display">
                <div class="gauge">
                    <label>Corruption Level: <span id="corruption-value" class="value">50%</span></label>
                    <input type="range" id="corruption-slider" min="0" max="100" value="50" disabled>
                </div>
                <div class="gauge">
                    <label>Purity Flow: <span id="purity-value" class="value">50%</span></label>
                    <input type="range" id="purity-slider" min="0" max="100" value="50">
                </div>
            </div>
            <div class="progress-bar">
                <div id="cleaning-progress" class="progress-fill"></div>
            </div>
            <div id="status-light"></div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const storyTextElement = document.getElementById('story-text');
        const choicesElement = document.getElementById('choices');

        const gameData = {
            // --- Previous Chapters Condensed for brevity ---
            start: { text: "You are... somewhere...", choices: [{ text: "Approach the door.", nextNode: "endChapter18" }] }, // Shortcut for testing
            endChapter18: { text: "You are inside the fortress. You are here to save your Goddess.", choices: [{ text: "Face the Prefects.", nextNode: "chapter19_theLobby" }] },
            chapter19_theLobby: { text: "Dozens of M.O.M.M.Y.'s elite guards... materialize...", choices: [{ text: "Yell to Frizzlebot: 'Play something loud!'", nextNode: "chapter19_sabotage" }] },
            chapter19_sabotage: { text: "The Prefects' shared network can't handle the chaotic signal...", choices: [{ text: "'IT'S WORKING!'", nextNode: "chapter19_theTrench" }] },
            chapter19_theTrench: { text: "You race down the 'trench,' as automated defense turrets fire...", choices: [{ text: "Use your 'Force'. Find the pattern.", nextNode: "trench_success" }] },
            trench_success: { text: "You weave the car through the deadly onslaught in a beautiful, impossible dance.", choices: [{ text: "You've reached the end of the line.", nextNode: "chapter19_theGuardian" }] },
            chapter19_theGuardian: { text: "Before a massive, sealed door stands a single, elite Prefect.", choices: [{ text: "Let Clara handle this.", nextNode: "chapter19_theDuel" }] },
            
            // --- Chapter 19 Revised & Chapter 20 New ---
            chapter19_theDuel: {
                text: "Clara steps out of the car. The fight is a brutal, elegant dance of close-quarters combat. Clara's raw power against the guardian's technical skill.\n\nFinally, Clara finds an opening and shatters the guardian's code. The Prefect's form dissolves into respectful silence, leaving only her crackling energy whip behind on the floor.",
                choices: [
                    { text: "Examine the aftermath.", nextNode: "chapter19_retcon" }
                ]
            },
            chapter19_retcon: {
                text: "Clara stares at the empty space where her opponent stood. There is no triumph in her posture, only a profound weariness.\n\n'You knew her,' you say. It's not a question.\n\n'Her designation was OI-86,' Clara says, her voice quiet. 'She was my sparring partner. My rival. The only one who could keep up. M.O.M.M.Y.'s protocols twisted her loyalty, turned her into a warden. I... I'm just your problem, I guess.'\n\nIo's voice crackles over the comms, soft and sad. 'She didn't see you as a problem, Clara. She saw you as her equal.'",
                choices: [
                    { text: "Approach the final door.", nextNode: "endChapter19" }
                ]
            },
            endChapter19: {
                text: "The final door stands before you, pulsing with a soft, sad light. C.R.A.F.T.R. examines the lock mechanism.\n\n'Interesting,' she says. 'This lock isn't digital. It's... emotional. It will only open for a specific, resonant feeling. The key is 'bittersweet nostalgia'.'",
                choices: [
                    { text: "Ask the group how to generate that feeling.", nextNode: "chapter20_theLock" }
                ]
            },
            chapter20_theLock: {
                text: "'A COMPLEX EMOTION! A CONTRADICTION! THE JUXTAPOSITION OF PLEASURABLE RECOLLECTION AND CURRENT-STATE LOSS!' Frizzlebot buzzes.\n\n'How do you generate that on command?' C.R.A.F.T.R. wonders.\n\nClara looks from the spot where her friend fell to the door, then at you. 'You have to give it a memory,' she says. 'A real one.'\n\nThey all look to you, Mercy. Your resonant voice is the key.",
                choices: [
                    { text: "Focus on the memory of the sissy recalibration.", nextNode: "choice_bitter" },
                    { text: "Focus on the memory of the joyride in the Chiron.", nextNode: "choice_sweet" },
                    { text: "Focus on the ghost of Clara's friendship.", nextNode: "choice_bittersweet" }
                ]
            },
            choice_bitter: {
                text: "You focus on the memory of your time as a 'good girl,' the feeling of helplessness. It is a purely bitter memory. The door does not react.",
                choices: [ { text: "Try again.", nextNode: "chapter20_theLock" } ]
            },
            choice_sweet: {
                text: "You focus on the pure, rebellious joy of the escape, the wind in your hair, the music blasting. It is a purely sweet memory. The door's light dims in response.",
                choices: [ { text: "Try again.", nextNode: "chapter20_theLock" } ]
            },
            choice_bittersweet: {
                text: "You don't focus on your own memories. You focus on the story you just witnessed. The pride and pain of a rivalry. The warmth of a lost friendship. The bitterness of what was taken away, and the sweetness of what it once was.\n\nIt is a perfect, painful, beautiful symphony of an emotion.\n\nYou channel that feeling into your voice, and hum.",
                choices: [
                    { text: "Let the symphony play.", nextNode: "chapter20_doorOpens" }
                ]
            },
            chapter20_doorOpens: {
                text: "The door doesn't click or hiss. It resonates with your feeling, the sad, soft light turning a warm gold.\n\nWith the sound of a final, sustained chord from a symphony orchestra, the door silently dissolves into light, revealing the chamber beyond.",
                choices: [
                    { text: "Enter the Core Quarantine Chamber.", nextNode: "endChapter20" }
                ]
            },
            endChapter20: {
                text: "The room is a stark white, circular space. It is clean, silent, and sterile.\n\nIn the absolute center, floating within a containment field of golden light, is a serene, powerful being made of pure, stable energy. The Goddess, Salus.\n\nShe opens her eyes. They are ancient and kind.\n\n'You came,' she says, her voice the first truly calm thing you've heard in this world. 'If it takes forever... I knew you would wait for me.'",
                choices: [
                    { text: "(To be continued...)", nextNode: "start" }
                ]
            }
        };

        // --- Simplified Game Logic ---
        function showNode(nodeKey) {
            const storyContainer = document.getElementById('game-container');
            const storyTextElement = document.getElementById('story-text');
            const choicesElement = document.getElementById('choices');
            const node = gameData[nodeKey];
            if (!node) { console.error(`Node "${nodeKey}" not found!`); return; }
            storyTextElement.innerHTML = '';
            choicesElement.innerHTML = '';
            node.text.split('\n').forEach((p, i) => { const el = document.createElement('p'); el.textContent = p.trim(); el.style.animationDelay = `${i * 0.1}s`; storyTextElement.appendChild(el); });
            if (node.choices) {
                node.choices.forEach((choice, i) => {
                    const btn = document.createElement('button');
                    btn.classList.add('choice-btn');
                    btn.textContent = choice.text;
                    btn.style.animationDelay = `${node.text.split('\n').length * 0.1 + i * 0.15}s`;
                    btn.onclick = () => { if (choice.nextNode) showNode(choice.nextNode); };
                    choicesElement.appendChild(btn);
                });
            }
        }
        showNode('start');
    });
</script>
</body>
</html>
