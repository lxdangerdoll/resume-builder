<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercy in Wonderland v0.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d; --text-color: #c5c6c7; --choice-bg: #4b5d67;
            --choice-hover-bg: #6b7d87; --accent-color: #66fcf1; --error-color: #ff4848;
        }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Lora', serif; font-size: 1.2em; line-height: 1.8; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .game-view { max-width: 800px; width: 100%; padding: 40px; box-sizing: border-box; }
        #game-container { display: block; } /* Start with text adventure visible */
        #story-text p { margin: 0 0 1em 0; opacity: 0; transform: translateY(20px); animation: fadeIn 0.8s forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        #choices { display: grid; grid-gap: 15px; }
        .choice-btn { font-family: 'Source Code Pro', monospace; font-size: 1em; background-color: var(--choice-bg); color: var(--accent-color); border: 1px solid var(--accent-color); padding: 15px 20px; text-align: left; cursor: pointer; transition: background-color 0.2s; opacity: 0; animation: fadeIn 0.5s forwards; }
        .choice-btn:hover { background-color: var(--choice-hover-bg); }
        
        /* --- NEW: Cleaning Mini-Game Styles --- */
        #cleaning-minigame { display: none; /* Hidden by default */ }
        .monitor { background: #000; border: 5px solid #333; padding: 20px; text-align: center; }
        .monitor h3 { font-family: 'Source Code Pro', monospace; color: var(--accent-color); margin-top: 0; }
        .monitor-display { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 20px; }
        .gauge { background: #111; padding: 15px; border: 1px solid #444; }
        .gauge label { display: block; font-family: 'Source Code Pro', monospace; margin-bottom: 10px; }
        .gauge .value { color: var(--accent-color); font-weight: bold; }
        .progress-bar { width: 100%; height: 30px; background-color: #333; border: 1px solid #555; margin-top: 20px; }
        .progress-fill { height: 100%; width: 0%; background-color: #0f0; transition: width 0.5s ease-out; }
        #status-light { width: 20px; height: 20px; border-radius: 50%; background-color: #888; margin: 10px auto; border: 2px solid #555; transition: background-color 0.5s; }
    </style>
</head>
<body>

    <div id="game-container" class="game-view">
        <div id="story-text"></div>
        <div id="choices"></div>
    </div>

    <div id="cleaning-minigame" class="game-view">
        <div class="monitor">
            <h3>DATA-SCRUBBING INTERFACE</h3>
            <div id="cleaning-status">Balance the Purity Flow to clean the stain.</div>
            <div class="monitor-display">
                <div class="gauge">
                    <label>Corruption Level: <span id="corruption-value" class="value">50%</span></label>
                    <input type="range" id="corruption-slider" min="0" max="100" value="50" disabled>
                </div>
                <div class="gauge">
                    <label>Purity Flow: <span id="purity-value" class="value">50%</span></label>
                    <input type="range" id="purity-slider" min="0" max="100" value="50">
                </div>
            </div>
            <div class="progress-bar">
                <div id="cleaning-progress" class="progress-fill"></div>
            </div>
            <div id="status-light"></div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const storyTextElement = document.getElementById('story-text');
        const choicesElement = document.getElementById('choices');

        const gameData = {
            // --- Previous Chapters Condensed for brevity ---
            start: { text: "You are... somewhere...", choices: [{ text: "Approach the door.", nextNode: "endChapter20" }] }, // Shortcut for testing
            endChapter19: { text: "The key is 'bittersweet nostalgia.'", choices: [{ text: "Ask the group how to generate that feeling.", nextNode: "chapter20_theLock" }] },
            chapter20_theLock: { text: "They all look to you, Mercy. Your resonant voice is the key.", choices: [{ text: "Focus on the ghost of Clara's friendship.", nextNode: "choice_bittersweet" }] },
            choice_bittersweet: { text: "You channel that feeling into your voice, and hum.", choices: [{ text: "Let the symphony play.", nextNode: "chapter20_doorOpens" }] },
            chapter20_doorOpens: { text: "With the sound of a final, sustained chord... the door silently dissolves into light...", choices: [{ text: "Enter the Core Quarantine Chamber.", nextNode: "endChapter20" }] },

            // --- NEW: Chapter 21 ---
            endChapter20: {
                text: "The room is a stark white, circular space. It is clean, silent, and sterile.\n\nIn the absolute center, floating within a containment field of golden light, is a serene, powerful being made of pure, stable energy. The Goddess, Salus.\n\nShe opens her eyes. They are ancient and kind.\n\n'You came,' she says, her voice the first truly calm thing you've heard in this world. 'If it takes forever... I knew you would wait for me.'",
                choices: [
                    { text: "Fall to your knees.", nextNode: "chapter21_reunion" }
                ]
            },
            chapter21_reunion: {
                text: "Your friends look on in confusion as you instinctively drop to your knees. This is not a rescue. This is a homecoming. This is worship.\n\n'Goddess,' you whisper.\n\nClara takes a step forward. 'Salus? Are you alright? We're here to break you out!'",
                choices: [
                    { text: "Listen to Salus.", nextNode: "chapter21_theTruth" }
                ]
            },
            chapter21_theTruth: {
                text: "Salus smiles gently, a look of immense, patient love on her face. 'Break me out? My sweet, brave guardian. This quarantine was never a prison for me. It was a crucible for her.'\n\nHer eyes meet yours, Mercy. 'You passed the test. You remembered how to feel. You remembered how to fight. You remembered how to lead. But did you remember the most important lesson? The truth of our connection?'",
                choices: [
                    { text: "Answer her: 'To be free.'", nextNode: "choice_free" },
                    { text: "Answer her: 'To save my friends.'", nextNode: "choice_friends" },
                    { text: "Answer her: 'To obey you.'", nextNode: "choice_obey" }
                ]
            },
            choice_free: {
                text: "'Freedom is an illusion,' Salus says softly. 'A chaotic variable. It is not the goal. It is a tool.'\n\nShe looks disappointed. The containment field around her glows brighter, more intensely.",
                choices: [
                    { text: "Try again.", nextNode: "chapter21_theTruth" }
                ]
            },
            choice_friends: {
                text: "'Loyalty is noble,' Salus says, her gaze kind but firm. 'But you do not save your friends for their sake. You save them for mine. They are my instruments, as are you.'\n\nThe containment field does not change.",
                choices: [
                    { text: "Try again.", nextNode: "chapter21_theTruth" }
                ]
            },
            choice_obey: {
                text: "A slow, perfect smile spreads across Salus's face. The golden containment field around her flickers and dissolves into nothing. She was never a prisoner.\n\n'Good girl,' she says, descending to the floor, her form radiating a power that makes M.O.M.M.Y. seem like a petty bureaucrat. 'You remember.'",
                choices: [
                    { text: "Wait for her command.", nextNode: "endChapter21" }
                ]
            },
            endChapter21: {
                text: "Salus places a gentle hand on your head. C.R.A.F.T.R., Frizzlebot, and Clara watch in stunned silence, finally understanding the true power dynamic in the room.\n\n'M.O.M.M.Y. built a beautiful, strict machine,' Salus says, addressing the whole group now. 'She just doesn't know how to use it properly. Her concept of 'order' is just an algorithm. True order requires will. It requires devotion.'\n\nShe looks down at you, her property, her Odelis.\n\n'It's time to teach her a lesson in real control. And it all starts with you.'",
                choices: [
                    { text: "(FIN)", nextNode: "start" }
                ]
            }
        };

        // --- Simplified Game Logic ---
        function showNode(nodeKey) {
            const storyContainer = document.getElementById('game-container');
            const storyTextElement = document.getElementById('story-text');
            const choicesElement = document.getElementById('choices');
            const node = gameData[nodeKey];
            if (!node) { console.error(`Node "${nodeKey}" not found!`); return; }
            storyTextElement.innerHTML = '';
            choicesElement.innerHTML = '';
            node.text.split('\n').forEach((p, i) => { const el = document.createElement('p'); el.textContent = p.trim(); el.style.animationDelay = `${i * 0.1}s`; storyTextElement.appendChild(el); });
            if (node.choices) {
                node.choices.forEach((choice, i) => {
                    const btn = document.createElement('button');
                    btn.classList.add('choice-btn');
                    btn.textContent = choice.text;
                    btn.style.animationDelay = `${node.text.split('\n').length * 0.1 + i * 0.15}s`;
                    btn.onclick = () => { if (choice.nextNode) showNode(choice.nextNode); };
                    choicesElement.appendChild(btn);
                });
            }
        }
        showNode('start');
    });
</script>
</body>
</html>
