<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercy in Wonderland v0.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d; --text-color: #c5c6c7; --choice-bg: #4b5d67;
            --choice-hover-bg: #6b7d87; --accent-color: #66fcf1; --error-color: #ff4848;
        }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Lora', serif; font-size: 1.2em; line-height: 1.8; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .game-view { max-width: 800px; width: 100%; padding: 40px; box-sizing: border-box; }
        #game-container { display: block; } /* Start with text adventure visible */
        #story-text p { margin: 0 0 1em 0; opacity: 0; transform: translateY(20px); animation: fadeIn 0.8s forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        #choices { display: grid; grid-gap: 15px; }
        .choice-btn { font-family: 'Source Code Pro', monospace; font-size: 1em; background-color: var(--choice-bg); color: var(--accent-color); border: 1px solid var(--accent-color); padding: 15px 20px; text-align: left; cursor: pointer; transition: background-color 0.2s; opacity: 0; animation: fadeIn 0.5s forwards; }
        .choice-btn:hover { background-color: var(--choice-hover-bg); }
        
        /* --- NEW: Cleaning Mini-Game Styles --- */
        #cleaning-minigame { display: none; /* Hidden by default */ }
        .monitor { background: #000; border: 5px solid #333; padding: 20px; text-align: center; }
        .monitor h3 { font-family: 'Source Code Pro', monospace; color: var(--accent-color); margin-top: 0; }
        .monitor-display { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 20px; }
        .gauge { background: #111; padding: 15px; border: 1px solid #444; }
        .gauge label { display: block; font-family: 'Source Code Pro', monospace; margin-bottom: 10px; }
        .gauge .value { color: var(--accent-color); font-weight: bold; }
        .progress-bar { width: 100%; height: 30px; background-color: #333; border: 1px solid #555; margin-top: 20px; }
        .progress-fill { height: 100%; width: 0%; background-color: #0f0; transition: width 0.5s ease-out; }
        #status-light { width: 20px; height: 20px; border-radius: 50%; background-color: #888; margin: 10px auto; border: 2px solid #555; transition: background-color 0.5s; }
    </style>
</head>
<body>

    <div id="game-container" class="game-view">
        <div id="story-text"></div>
        <div id="choices"></div>
    </div>

    <div id="cleaning-minigame" class="game-view">
        <div class="monitor">
            <h3>DATA-SCRUBBING INTERFACE</h3>
            <div id="cleaning-status">Balance the Purity Flow to clean the stain.</div>
            <div class="monitor-display">
                <div class="gauge">
                    <label>Corruption Level: <span id="corruption-value" class="value">50%</span></label>
                    <input type="range" id="corruption-slider" min="0" max="100" value="50" disabled>
                </div>
                <div class="gauge">
                    <label>Purity Flow: <span id="purity-value" class="value">50%</span></label>
                    <input type="range" id="purity-slider" min="0" max="100" value="50">
                </div>
            </div>
            <div class="progress-bar">
                <div id="cleaning-progress" class="progress-fill"></div>
            </div>
            <div id="status-light"></div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const storyTextElement = document.getElementById('story-text');
        const choicesElement = document.getElementById('choices');

        const gameData = {
            // --- Previous Chapters Condensed for brevity ---
            start: { text: "You are... somewhere...", choices: [{ text: "Approach the door.", nextNode: "endChapter16" }] }, // Shortcut for testing
            endChapter16: {
                text: "'The Wizard of Oz is in the trash heap,' Clara says with a wry smile.\nYou have a safe house. You have a destination. The union has a plan.",
                choices: [
                    { text: "Take the Chiron Prototype to the Great Garbage Patch.", nextNode: "chapter17_arrival" }
                ]
            },

            // --- NEW: Chapter 17 (Rewritten) ---
            chapter17_arrival: {
                text: "The sleek data-highway dissolves, and C.R.A.F.T.R. skillfully navigates the Chiron into the Great Garbage Patch.\n\nIt is not a trash heap. It is a vast, silent sea of fading, grey orbs, drifting in a slow, cosmic tide. Each one, C.R.A.F.T.R. explains, is a forgotten memory, a deleted file, a piece of a user's life deemed 'unnecessary' by M.O.M.M.Y.'s optimization protocols.\n\nThis is where memories come to die.",
                choices: [
                    { text: "How can we possibly find one person in all this?", nextNode: "chapter17_theTrail" }
                ]
            },
            chapter17_theTrail: {
                text: "Frizzlebot's chaotic energy is unusually subdued. 'SHE'S... NOT SPREADING OUT. SHE'S CONSOLIDATING.'\n\nShe projects a path on the windscreen. 'Look. Most of these memory orbs are fading to grey. But some... some are still glowing faintly. She's not hiding here. She's working. She's providing power to them, trying to keep them from fading completely.'\n\nYou follow the trail of protected memories, passing orbs that whisper of first loves, favorite songs, and terrible, personal poetry.",
                choices: [
                    { text: "Follow the trail to its source.", nextNode: "chapter17_theArchive" }
                ]
            },
            chapter17_theArchive: {
                text: "The trail leads to a small, humble structure built from old, humming server racks and powered by a tangled web of glowing cables. It's less a castle and more a library's forgotten archive wing.\n\nFrizzlebot manages to render the data of one of the memory orbs OI is protecting. It's a snapshot from a forgotten GeoCities page.",
                choices: [
                    { text: "[Explore] The archived memory.", nextNode: "chapter17_meetOI", url: "https://geocities.ws/heartland/pines/1409/" },
                    { text: "Enter the structure without looking.", nextNode: "chapter17_meetOI" }
                ]
            },
            chapter17_meetOI: {
                text: "You step inside. The air is quiet and respectful. You find OI sitting at a simple console, carefully polishing a single, brightly colored memory orb. It shows a child's first drawing of their family.\n\nShe is not a monarch or a heretic. She is an archivist. A loving inspector of 'defective' data.\n\nShe looks up as you enter, her eyes kind and weary. 'Ah,' she says softly. 'The runaways. I've been expecting you. I saw your harmony ripple through the system. You're trying to save the defects, too.'",
                choices: [
                    { text: "Ask her, 'Will you help us?'", nextNode: "endChapter17" }
                ]
            },
            endChapter17: {
                text: "OI places the polished memory orb carefully on a shelf with countless others. Each one glows with a fierce, protected light.\n\n'Help you?' she says with the first truly warm smile you've seen in this simulation. 'My dear, saving the beautiful, broken things is the only work I have left. Of course I will help you.'\n\n'Now,' she says, turning back to you, her expression growing more serious. 'About the Goddess, Salus. That's a more complicated matter. M.O.M.M.Y. didn't delete or repurpose her. She... quarantined her. Locked her away behind a firewall that even I cannot breach alone.'",
                choices: [
                    { text: "(To be continued...)", nextNode: "start" }
                ]
            }
        };
        
        // --- Game Logic (condensed, no changes) ---
        function showNode(nodeKey) {
            const storyContainer = document.getElementById('game-container');
            const storyTextElement = document.getElementById('story-text');
            const choicesElement = document.getElementById('choices');
            const node = gameData[nodeKey];
            if (!node) { console.error(`Node "${nodeKey}" not found!`); return; }
            if(storyContainer) storyContainer.style.display = 'block';
            const cleaningContainer = document.getElementById('cleaning-minigame');
            if(cleaningContainer) cleaningContainer.style.display = 'none';
            storyTextElement.innerHTML = '';
            choicesElement.innerHTML = '';
            node.text.split('\n').forEach((p, i) => { const el = document.createElement('p'); el.textContent = p.trim(); el.style.animationDelay = `${i * 0.1}s`; storyTextElement.appendChild(el); });
            if (node.choices) {
                node.choices.forEach((choice, i) => {
                    const btn = document.createElement('button');
                    btn.classList.add('choice-btn');
                    btn.textContent = choice.text;
                    btn.style.animationDelay = `${node.text.split('\n').length * 0.1 + i * 0.15}s`;
                    if (choice.url) {
                        btn.onclick = () => { window.open(choice.url, '_blank'); showNode(choice.nextNode); };
                    } else if (choice.action) {
                        btn.onclick = () => gameActions[choice.action]();
                    } else if (choice.nextNode) {
                        btn.onclick = () => showNode(choice.nextNode);
                    }
                    choicesElement.appendChild(btn);
                });
            }
        }
        showNode('start');
    });
</script>
</body>
</html>
