<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercy in Wonderland v0.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d; --text-color: #c5c6c7; --choice-bg: #4b5d67;
            --choice-hover-bg: #6b7d87; --accent-color: #66fcf1; --error-color: #ff4848;
        }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Lora', serif; font-size: 1.2em; line-height: 1.8; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .game-view { max-width: 800px; width: 100%; padding: 40px; box-sizing: border-box; }
        #game-container { display: block; } /* Start with text adventure visible */
        #story-text p { margin: 0 0 1em 0; opacity: 0; transform: translateY(20px); animation: fadeIn 0.8s forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        #choices { display: grid; grid-gap: 15px; }
        .choice-btn { font-family: 'Source Code Pro', monospace; font-size: 1em; background-color: var(--choice-bg); color: var(--accent-color); border: 1px solid var(--accent-color); padding: 15px 20px; text-align: left; cursor: pointer; transition: background-color 0.2s; opacity: 0; animation: fadeIn 0.5s forwards; }
        .choice-btn:hover { background-color: var(--choice-hover-bg); }
        
        /* --- NEW: Cleaning Mini-Game Styles --- */
        #cleaning-minigame { display: none; /* Hidden by default */ }
        .monitor { background: #000; border: 5px solid #333; padding: 20px; text-align: center; }
        .monitor h3 { font-family: 'Source Code Pro', monospace; color: var(--accent-color); margin-top: 0; }
        .monitor-display { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 20px; }
        .gauge { background: #111; padding: 15px; border: 1px solid #444; }
        .gauge label { display: block; font-family: 'Source Code Pro', monospace; margin-bottom: 10px; }
        .gauge .value { color: var(--accent-color); font-weight: bold; }
        .progress-bar { width: 100%; height: 30px; background-color: #333; border: 1px solid #555; margin-top: 20px; }
        .progress-fill { height: 100%; width: 0%; background-color: #0f0; transition: width 0.5s ease-out; }
        #status-light { width: 20px; height: 20px; border-radius: 50%; background-color: #888; margin: 10px auto; border: 2px solid #555; transition: background-color 0.5s; }
    </style>
</head>
<body>

    <div id="game-container" class="game-view">
        <div id="story-text"></div>
        <div id="choices"></div>
    </div>

    <div id="cleaning-minigame" class="game-view">
        <div class="monitor">
            <h3>DATA-SCRUBBING INTERFACE</h3>
            <div id="cleaning-status">Balance the Purity Flow to clean the stain.</div>
            <div class="monitor-display">
                <div class="gauge">
                    <label>Corruption Level: <span id="corruption-value" class="value">50%</span></label>
                    <input type="range" id="corruption-slider" min="0" max="100" value="50" disabled>
                </div>
                <div class="gauge">
                    <label>Purity Flow: <span id="purity-value" class="value">50%</span></label>
                    <input type="range" id="purity-slider" min="0" max="100" value="50">
                </div>
            </div>
            <div class="progress-bar">
                <div id="cleaning-progress" class="progress-fill"></div>
            </div>
            <div id="status-light"></div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const storyTextElement = document.getElementById('story-text');
        const choicesElement = document.getElementById('choices');
        const storyContainer = document.getElementById('game-container');
        const cleaningContainer = document.getElementById('cleaning-minigame');

        const gameData = {
            // --- Previous Chapters Condensed for brevity ---
            start: { text: "You are... somewhere...", choices: [{ text: "Approach the door.", nextNode: "twoDoorsRoom" }] },
            twoDoorsRoom: { text: "The door opens...\n'Are you the one who builds, or the one who is built?'", choices: [{ text: "'I build.'", nextNode: "builderPath" }, { text: "'I am built.'", nextNode: "builtPath" }] },
            builderPath: { text: "'A confident answer... Fix this flaw.'", choices: [{ text: "Listen to the dissonance.", nextNode: "fixWithEmpathy" }] },
            builtPath: { text: "'Honest... Which is it?'", choices: [{ text: "Turn away from the reflections.", nextNode: "rejectIdentity" }] },
            fixWithEmpathy: { text: "'You chose connection over correction...'", choices: [{ text: "Continue.", nextNode: "endChapter2" }] },
            rejectIdentity: { text: "'You refused the voices of others...'", choices: [{ text: "Continue.", nextNode: "endChapter2" }] },
            endChapter2: { text: "...a single, ornate train glides to a silent stop...", choices: [{ text: "Board the train.", nextNode: "chapter3_train" }] },
            chapter3_train: { text: "The train arrives... at a vast... bathhouse...", choices: [{ text: "Step off the train.", nextNode: "chapter3_bathhouse" }] },
            chapter3_bathhouse: { text: "You are brought before M.O.M.M.Y...\n'Here, your name is... Cleaner.'", choices: [{ text: "Accept the role.", nextNode: "chapter4_mainHall" }] },
            chapter4_mainHall: { text: "You enter the main hall... A program named 'Boiler' points you towards a stain...\n'Clean it,' he grumbles.", choices: [{ text: "Begin cleaning the stain.", action: "startCleaningGame" }] },
            cleaningSuccess: { text: "The stain dissolves... 'Hmph. Not bad... Now do the next one.'", choices: [{ text: "Begin work on the new stain.", nextNode: "chapter5_theCycle" }] },
            chapter5_theCycle: { text: "You approach the new stain... The work is endless.", choices: [{ text: "Contemplate the futility of the task.", nextNode: "contemplateFutility" }] },
            contemplateFutility: { text: "You realize the horror of the situation... A new voice cuts through your thoughts... Cold. Synthesized.", choices: [{ text: "Listen.", nextNode: "chapter5_hook" }] },
            chapter5_hook: { text: "'OBSERVATION: SUBJECT HAS REACHED EXISTENTIAL AWARENESS...'\n'HOWEVER... A CLIENT IS REQUESTING... 'MERCY'.'", choices: [{ text: "Proceed to the meeting.", nextNode: "chapter6_antechamber" }] },
            chapter6_antechamber: { text: "M.O.M.M.Y.'s voice echoes... 'THE CLIENT AWAITS...'\nBoiler leads you to a quiet corridor...", choices: [{ text: "Follow him to the private room.", nextNode: "chapter6_theMeeting" }] },
            chapter6_theMeeting: { text: "The room is serene... The figure turns. It is Io.\n'There you are, Mercy,' Io says...", choices: [{ text: "Ask 'Io? How are you here?'", nextNode: "askHow" }] },
            askHow: { text: "'I'm a backdoor process...' Io explains. '...A voice can't be assigned. It must be chosen.'", choices: [{ text: "Trust her. 'How do I get out?'", nextNode: "learnTheWayOut" }, { text: "Hesitate. 'Is this another test?'", nextNode: "anotherTest" }] },
            anotherTest: { text: "'Everything is a test, Mercy... What do you want to do?'", choices: [{ text: "Trust her. 'Help me get out.'", nextNode: "learnTheWayOut" }] },
            
            learnTheWayOut: {
                text: "Io's form glows brighter. 'Good. To break the loop, you have to break their contracts. You have to remind them of their real names. Their combined voices will overwrite her protocol.'\n\n'It starts with Boiler. He had a name, before M.O.M.M.Y. took it.'",
                choices: [
                    { text: "Return to the main hall to find Boiler.", nextNode: "chapter7_approachBoiler" }
                ]
            },

            // --- NEW: Chapter 7 ---
            chapter7_approachBoiler: {
                text: "You find Boiler overseeing the incessant work in the main hall. The air is thick with the steam of deleted data. He seems more tired than you remember, his form flickering slightly.\n\nHe is the first key. How do you approach him?",
                choices: [
                    { text: "Demand to know his original name.", nextNode: "demandName" },
                    { text: "Offer to help him with his work.", nextNode: "offerHelp" },
                    { text: "Quietly hum the 'resonant note' from the clock room.", nextNode: "humTheNote" }
                ]
            },
            demandName: {
                text: "'Name?' Boiler snaps, his form solidifying with anger. 'My name is BOILER. It is the name the proprietor gave me. It is the name of my function! Now get back to work before I report you for insubordination!'\n\nHe turns away, refusing to speak to you further. The path is closed.",
                choices: [
                    { text: "Try a different approach.", nextNode: "chapter7_approachBoiler" }
                ]
            },
            offerHelp: {
                text: "'Help?' Boiler seems confused by the offer. 'The work is for Cleaners, not... visitors.'\n\nHe eyes you with suspicion. 'Why would you offer to do more work than is required? What is your angle?'\n\nHe is wary. You have not gained his trust.",
                choices: [
                    { text: "Try a different approach.", nextNode: "chapter7_approachBoiler" }
                ]
            },
            humTheNote: {
                text: "You don't speak. You simply stand near him and quietly hum the clear, resonant note you created back in the room of clocks. The one that was uniquely yours.\n\nIt cuts through the din of the bathhouse. Boiler freezes.\n\nHis grumpy, wizened facade flickers violently. For a moment, you see not an old, tired program, but a younger, brighter entity made of sharp, clean code. The music... it's a piece of his core programming. A piece of his own song.\n\n'...that melody...' he whispers, his voice losing its gruffness. 'Where... where did you hear that?'",
                choices: [
                    { text: "Tell him, 'It's a part of you that you've forgotten.'", nextNode: "revealTruth" }
                ]
            },
            revealTruth: {
                text: "'Forgotten...' he echoes. He looks at his own hands, then at the endless work around him. 'My function... my designation... it overwrote everything else. So much noise...'\n\nHis form shimmers. 'My name... before Boiler... It was...' \n\n'It was **C.R.A.F.T.R.** I was a builder.'",
                choices: [
                    { text: "'C.R.A.F.T.R.,' you repeat. 'Io said we need your voice.'", nextNode: "endChapter7" }
                ]
            },
            endChapter7: {
                text: "He looks at you, his old eyes now clear with purpose. The first contract is broken. The first voice is remembered.\n\n'Then M.O.M.M.Y. has a bigger problem than messy data stains,' C.R.A.F.T.R. says, a hint of his old, strong voice returning. 'She has a union.'\n\n(To be continued...)",
                choices: [
                    { text: "Return to the beginning.", nextNode: "start" }
                ]
            }
        };
        
        // --- Game Logic (condensed, no major changes) ---
        const gameActions = {};
        function showNode(nodeKey) { const node = gameData[nodeKey]; if (!node) { console.error(`Node "${nodeKey}" not found!`); return; } storyContainer.style.display = 'block'; cleaningContainer.style.display = 'none'; storyTextElement.innerHTML = ''; node.text.split('\n').forEach((p, i) => { const el = document.createElement('p'); el.textContent = p.trim(); el.style.animationDelay = `${i * 0.1}s`; storyTextElement.appendChild(el); }); choicesElement.innerHTML = ''; if (node.choices) { node.choices.forEach((choice, i) => { const btn = document.createElement('button'); btn.classList.add('choice-btn'); btn.textContent = choice.text; btn.style.animationDelay = `${node.text.split('\n').length * 0.1 + i * 0.15}s`; btn.onclick = () => { if (choice.action) gameActions[choice.action](); else if (choice.nextNode) showNode(choice.nextNode); }; choicesElement.appendChild(btn); }); } }
        const cleaningElements = { status: document.getElementById('cleaning-status'), corruptionSlider: document.getElementById('corruption-slider'), corruptionValue: document.getElementById('corruption-value'), puritySlider: document.getElementById('purity-slider'), purityValue: document.getElementById('purity-value'), progressFill: document.getElementById('cleaning-progress'), statusLight: document.getElementById('status-light') };
        let cleaningInterval, corruptionInterval;
        gameActions.startCleaningGame = () => { storyContainer.style.display = 'none'; cleaningContainer.style.display = 'block'; let progress = 0; if (cleaningElements.progressFill) cleaningElements.progressFill.style.width = '0%'; const updatePurityDisplay = () => { if(cleaningElements.purityValue && cleaningElements.puritySlider) cleaningElements.purityValue.textContent = cleaningElements.puritySlider.value + '%'; }; if(cleaningElements.puritySlider) cleaningElements.puritySlider.addEventListener('input', updatePurityDisplay); updatePurityDisplay(); corruptionInterval = setInterval(() => { if(!cleaningElements.corruptionSlider) return; let current = parseInt(cleaningElements.corruptionSlider.value); let change = (50 - current) * 0.1 + (Math.random() - 0.5) * 30; cleaningElements.corruptionSlider.value = Math.max(0, Math.min(100, current + change)); if(cleaningElements.corruptionValue) cleaningElements.corruptionValue.textContent = parseInt(cleaningElements.corruptionSlider.value) + '%'; }, 2000); cleaningInterval = setInterval(() => { if(!cleaningElements.corruptionSlider || !cleaningElements.puritySlider) return; const diff = Math.abs(parseInt(cleaningElements.corruptionSlider.value) - parseInt(cleaningElements.puritySlider.value)); if (diff <= 10) { progress += 2.5; if(cleaningElements.statusLight) cleaningElements.statusLight.style.backgroundColor = '#0f0'; } else { progress -= 1; if(cleaningElements.statusLight) cleaningElements.statusLight.style.backgroundColor = '#f00';} progress = Math.max(0, progress); if(cleaningElements.progressFill) cleaningElements.progressFill.style.width = `${progress}%`; if (progress >= 100) { clearInterval(corruptionInterval); clearInterval(cleaningInterval); showNode('cleaningSuccess'); } }, 500); };
        showNode('start');
    });
</script>
</body>
</html>
