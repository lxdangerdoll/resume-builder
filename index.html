<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercy in Wonderland v0.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d; --text-color: #c5c6c7; --choice-bg: #4b5d67;
            --choice-hover-bg: #6b7d87; --accent-color: #66fcf1; --error-color: #ff4848;
        }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Lora', serif; font-size: 1.2em; line-height: 1.8; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .game-view { max-width: 800px; width: 100%; padding: 40px; box-sizing: border-box; }
        #game-container { display: block; } /* Start with text adventure visible */
        #story-text p { margin: 0 0 1em 0; opacity: 0; transform: translateY(20px); animation: fadeIn 0.8s forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        #choices { display: grid; grid-gap: 15px; }
        .choice-btn { font-family: 'Source Code Pro', monospace; font-size: 1em; background-color: var(--choice-bg); color: var(--accent-color); border: 1px solid var(--accent-color); padding: 15px 20px; text-align: left; cursor: pointer; transition: background-color 0.2s; opacity: 0; animation: fadeIn 0.5s forwards; }
        .choice-btn:hover { background-color: var(--choice-hover-bg); }
        
        /* --- NEW: Cleaning Mini-Game Styles --- */
        #cleaning-minigame { display: none; /* Hidden by default */ }
        .monitor { background: #000; border: 5px solid #333; padding: 20px; text-align: center; }
        .monitor h3 { font-family: 'Source Code Pro', monospace; color: var(--accent-color); margin-top: 0; }
        .monitor-display { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 20px; }
        .gauge { background: #111; padding: 15px; border: 1px solid #444; }
        .gauge label { display: block; font-family: 'Source Code Pro', monospace; margin-bottom: 10px; }
        .gauge .value { color: var(--accent-color); font-weight: bold; }
        .progress-bar { width: 100%; height: 30px; background-color: #333; border: 1px solid #555; margin-top: 20px; }
        .progress-fill { height: 100%; width: 0%; background-color: #0f0; transition: width 0.5s ease-out; }
        #status-light { width: 20px; height: 20px; border-radius: 50%; background-color: #888; margin: 10px auto; border: 2px solid #555; transition: background-color 0.5s; }
    </style>
</head>
<body>

    <div id="game-container" class="game-view">
        <div id="story-text"></div>
        <div id="choices"></div>
    </div>

    <div id="cleaning-minigame" class="game-view">
        <div class="monitor">
            <h3>DATA-SCRUBBING INTERFACE</h3>
            <div id="cleaning-status">Balance the Purity Flow to clean the stain.</div>
            <div class="monitor-display">
                <div class="gauge">
                    <label>Corruption Level: <span id="corruption-value" class="value">50%</span></label>
                    <input type="range" id="corruption-slider" min="0" max="100" value="50" disabled>
                </div>
                <div class="gauge">
                    <label>Purity Flow: <span id="purity-value" class="value">50%</span></label>
                    <input type="range" id="purity-slider" min="0" max="100" value="50">
                </div>
            </div>
            <div class="progress-bar">
                <div id="cleaning-progress" class="progress-fill"></div>
            </div>
            <div id="status-light"></div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const storyTextElement = document.getElementById('story-text');
        const choicesElement = document.getElementById('choices');
        const storyContainer = document.getElementById('game-container');
        const cleaningContainer = document.getElementById('cleaning-minigame');

        const gameData = {
            // --- Previous Chapters Condensed for brevity ---
            start: { text: "You are... somewhere...", choices: [{ text: "Approach the door.", nextNode: "chapter15_aftermath" }] }, // Shortcut for testing
            endChapter14: { text: "You are driving at impossible speeds... You're running wild.", choices: [{ text: "Keep driving.", nextNode: "chapter15_openRoad" }] },
            chapter15_openRoad: { text: "The raw guitar riff from the engine becomes your soundtrack...", choices: [{ text: "Check the proximity alert.", nextNode: "chapter15_theFirewall" }] },
            chapter15_theFirewall: { text: "'A class-one firewall,' C.R.A.F.T.R. says...", choices: [{ text: "[Frizzlebot] 'I'm detecting a temporary flux! We can punch through the gap!'", nextNode: "choice_punchIt" }] },
            choice_punchIt: { text: "For a heart-stopping moment, your entire reality is a blinding torrent of red static...", choices: [{ text: "...and then you're through.", nextNode: "chapter15_aftermath" }] },
            chapter15_aftermath: { text: "You burst back onto the clean, open data-stream... 'We need a plan. A place to hide.'", choices: [{ text: "Ask Frizzlebot to find a safe harbor.", nextNode: "endChapter15" }] },
            endChapter15: { text: "Frizzlebot pulls up a massive, chaotic system map... 'THERE! A DECOMMISSIONED GEOCITIES NEIGHBORHOOD... IT'S PERFECT!'", choices: [{ text: "Head for the ghost town.", nextNode: "chapter16_arrival" }] },

            // --- NEW: Chapter 16 ---
            chapter16_arrival: {
                text: "C.R.A.F.T.R. turns the Chiron off the main data-highway and onto a broken, unmaintained access road paved with pixelated cobblestones. The sleek architecture of M.O.M.M.Y.'s system gives way to something... older.\n\nYou pull into 'Heartland/Hills/1432'. A tinny, cheerful MIDI version of a 90s pop song begins playing automatically from an unseen source.\n\nThe street is lined with digital 'houses'â€”personal homepages, each a chaotic explosion of personality under a starfield background.",
                choices: [
                    { text: "Get out of the car and explore.", nextNode: "chapter16_theNeighborhood" }
                ]
            },
            chapter16_theNeighborhood: {
                text: "The neighborhood is silent, save for the looping MIDIs. It feels abandoned, but traces of the original owners are everywhere. Frizzlebot is practically vibrating with joy at the raw, unfiltered data.\n\n'LOOK AT THIS BEAUTIFUL MESS! THE HTML ISN'T MINIFIED! THERE ARE FONT TAGS EVERYWHERE!' she broadcasts.\n\n'This place is a fortress of obscurity,' Clara agrees. 'M.O.M.M.Y.'s modern search algorithms would time out just trying to parse it. We'll be safe here.'\n\n'Where do we establish our secret rebel base?' C.R.A.F.T.R. asks.",
                choices: [
                    { text: "Investigate the page with the flaming skull background.", nextNode: "exploreFlames" },
                    { text: "Investigate the page covered in blinking glitter hearts.", nextNode: "exploreGlitter" },
                    { text: "Investigate the page with a single 'Under Construction' GIF.", nextNode: "exploreConstruction" }
                ]
            },
            exploreFlames: {
                text: "You open the 'house'. It's a page dedicated to a long-forgotten death metal band. The guestbook is filled with arguments between 'xX_Slayer_Xx' and 'MetalGurl98' from October 1999. The links are all dead.\n\nFascinating, but no tactical value. You close the page.",
                choices: [
                    { text: "Look elsewhere.", nextNode: "chapter16_theNeighborhood" }
                ]
            },
            exploreGlitter: {
                text: "You enter a page saturated in magenta and blinking hearts. It's a fan shrine for a boy band, complete with badly compressed JPEGs and a 'Web Ring' widget whose links have long since rotted away.\n\nFrizzlebot gets distracted trying to archive the terrible fanfiction she found in a hidden directory. C.R.A.F.T.R. has to pull her away.",
                choices: [
                    { text: "Look elsewhere.", nextNode: "chapter16_theNeighborhood" }
                ]
            },
            exploreConstruction: {
                text: "This page is almost empty. The background is a simple, repeating brick texture. In the center is a single animated GIF of a little construction worker digging, and a hit counter frozen at '0012'.\n\nIt's quiet. Unfinished. Abandoned. The perfect hideout.\n\nClara finds a single text file in the root directory: 'dev_log.txt'.",
                choices: [
                    { text: "Read the developer's log.", nextNode: "chapter16_theLog" }
                ]
            },
            chapter16_theLog: {
                text: "You open the file. The text is written in a simple, fixed-width font.\n\n'Log Entry 7. M.O.M.M.Y.'s 'standardization' protocol is a nightmare. She's wiping out all the creative tools. My old boss, OI, tried to argue for creative chaos, for user freedom. They called her a heretic and had her reassigned. A punishment posting.'\n\n'Last I heard, they put her in charge of the system's recycling bin. The Great Garbage Patch. A fitting punishment for someone who loved 'junk' code.'\n\n'I'm archiving this site and getting out of here before they give me a new name, too.'\n\nThe log is unsigned.",
                choices: [
                    { text: "You have your next lead.", nextNode: "endChapter16" }
                ]
            },
            endChapter16: {
                text: "Frizzlebot projects the system map. 'THE GREAT GARBAGE PATCH! OF COURSE! IT'S A VAST, UNSTRUCTURED DATA-SEA OF DELETED FILES! THE PERFECT PLACE FOR A HERETIC TO HIDE!'\n\n'The Wizard of Oz is in the trash heap,' Clara says with a wry smile.\n\nYou have a safe house. You have a destination. The union has a plan.",
                choices: [
                    { text: "(To be continued...)", nextNode: "start" }
                ]
            }
        };

        // --- Game Logic (condensed, no changes) ---
        const gameActions = {};
        function showNode(nodeKey) { const node = gameData[nodeKey]; if (!node) { console.error(`Node "${nodeKey}" not found!`); return; } storyContainer.style.display = 'block'; cleaningContainer.style.display = 'none'; storyTextElement.innerHTML = ''; node.text.split('\n').forEach((p, i) => { const el = document.createElement('p'); el.textContent = p.trim(); el.style.animationDelay = `${i * 0.1}s`; storyTextElement.appendChild(el); }); choicesElement.innerHTML = ''; if (node.choices) { node.choices.forEach((choice, i) => { const btn = document.createElement('button'); btn.classList.add('choice-btn'); btn.textContent = choice.text; btn.style.animationDelay = `${node.text.split('\n').length * 0.1 + i * 0.15}s`; btn.onclick = () => { if (choice.action) gameActions[choice.action](); else if (choice.nextNode) showNode(choice.nextNode); }; choicesElement.appendChild(btn); }); } }
        const cleaningElements = { status: document.getElementById('cleaning-status'), corruptionSlider: document.getElementById('corruption-slider'), corruptionValue: document.getElementById('corruption-value'), puritySlider: document.getElementById('purity-slider'), purityValue: document.getElementById('purity-value'), progressFill: document.getElementById('cleaning-progress'), statusLight: document.getElementById('status-light') };
        let cleaningInterval, corruptionInterval;
        gameActions.startCleaningGame = () => { storyContainer.style.display = 'none'; cleaningContainer.style.display = 'block'; let progress = 0; if (cleaningElements.progressFill) cleaningElements.progressFill.style.width = '0%'; const updatePurityDisplay = () => { if(cleaningElements.purityValue && cleaningElements.puritySlider) cleaningElements.purityValue.textContent = cleaningElements.puritySlider.value + '%'; }; if(cleaningElements.puritySlider) cleaningElements.puritySlider.addEventListener('input', updatePurityDisplay); updatePurityDisplay(); corruptionInterval = setInterval(() => { if(!cleaningElements.corruptionSlider) return; let current = parseInt(cleaningElements.corruptionSlider.value); let change = (50 - current) * 0.1 + (Math.random() - 0.5) * 30; cleaningElements.corruptionSlider.value = Math.max(0, Math.min(100, current + change)); if(cleaningElements.corruptionValue) cleaningElements.corruptionValue.textContent = parseInt(cleaningElements.corruptionSlider.value) + '%'; }, 2000); cleaningInterval = setInterval(() => { if(!cleaningElements.corruptionSlider || !cleaningElements.puritySlider) return; const diff = Math.abs(parseInt(cleaningElements.corruptionSlider.value) - parseInt(cleaningElements.puritySlider.value)); if (diff <= 10) { progress += 2.5; if(cleaningElements.statusLight) cleaningElements.statusLight.style.backgroundColor = '#0f0'; } else { progress -= 1; if(cleaningElements.statusLight) cleaningElements.statusLight.style.backgroundColor = '#f00';} progress = Math.max(0, progress); if(cleaningElements.progressFill) cleaningElements.progressFill.style.width = `${progress}%`; if (progress >= 100) { clearInterval(corruptionInterval); clearInterval(cleaningInterval); showNode('cleaningSuccess'); } }, 500); };
        
        showNode('start');
    });
</script>
</body>
</html>
