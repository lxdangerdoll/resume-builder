<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercy in Wonderland v0.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d; --text-color: #c5c6c7; --choice-bg: #4b5d67;
            --choice-hover-bg: #6b7d87; --accent-color: #66fcf1; --error-color: #ff4848;
        }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Lora', serif; font-size: 1.2em; line-height: 1.8; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .game-view { max-width: 800px; width: 100%; padding: 40px; box-sizing: border-box; }
        #game-container { display: block; } /* Start with text adventure visible */
        #story-text p { margin: 0 0 1em 0; opacity: 0; transform: translateY(20px); animation: fadeIn 0.8s forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        #choices { display: grid; grid-gap: 15px; }
        .choice-btn { font-family: 'Source Code Pro', monospace; font-size: 1em; background-color: var(--choice-bg); color: var(--accent-color); border: 1px solid var(--accent-color); padding: 15px 20px; text-align: left; cursor: pointer; transition: background-color 0.2s; opacity: 0; animation: fadeIn 0.5s forwards; }
        .choice-btn:hover { background-color: var(--choice-hover-bg); }
        
        /* --- NEW: Cleaning Mini-Game Styles --- */
        #cleaning-minigame { display: none; /* Hidden by default */ }
        .monitor { background: #000; border: 5px solid #333; padding: 20px; text-align: center; }
        .monitor h3 { font-family: 'Source Code Pro', monospace; color: var(--accent-color); margin-top: 0; }
        .monitor-display { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 20px; }
        .gauge { background: #111; padding: 15px; border: 1px solid #444; }
        .gauge label { display: block; font-family: 'Source Code Pro', monospace; margin-bottom: 10px; }
        .gauge .value { color: var(--accent-color); font-weight: bold; }
        .progress-bar { width: 100%; height: 30px; background-color: #333; border: 1px solid #555; margin-top: 20px; }
        .progress-fill { height: 100%; width: 0%; background-color: #0f0; transition: width 0.5s ease-out; }
        #status-light { width: 20px; height: 20px; border-radius: 50%; background-color: #888; margin: 10px auto; border: 2px solid #555; transition: background-color 0.5s; }
    </style>
</head>
<body>

    <div id="game-container" class="game-view">
        <div id="story-text"></div>
        <div id="choices"></div>
    </div>

    <div id="cleaning-minigame" class="game-view">
        <div class="monitor">
            <h3>DATA-SCRUBBING INTERFACE</h3>
            <div id="cleaning-status">Balance the Purity Flow to clean the stain.</div>
            <div class="monitor-display">
                <div class="gauge">
                    <label>Corruption Level: <span id="corruption-value" class="value">50%</span></label>
                    <input type="range" id="corruption-slider" min="0" max="100" value="50" disabled>
                </div>
                <div class="gauge">
                    <label>Purity Flow: <span id="purity-value" class="value">50%</span></label>
                    <input type="range" id="purity-slider" min="0" max="100" value="50">
                </div>
            </div>
            <div class="progress-bar">
                <div id="cleaning-progress" class="progress-fill"></div>
            </div>
            <div id="status-light"></div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const storyTextElement = document.getElementById('story-text');
        const choicesElement = document.getElementById('choices');
        const storyContainer = document.getElementById('game-container');
        const cleaningContainer = document.getElementById('cleaning-minigame');

        const gameData = {
            // --- Previous Chapters Condensed ---
            start: { text: "You are... somewhere...", choices: [{ text: "Approach the door.", nextNode: "twoDoorsRoom" }] },
            twoDoorsRoom: { text: "The door opens into a room of clocks...\n'Are you the one who builds, or the one who is built?'", choices: [{ text: "'I am the one who builds.'", nextNode: "builderPath" }, { text: "'I am the one who is built.'", nextNode: "builtPath" }] },
            builderPath: { text: "'A confident answer...\nFix this flaw.'", choices: [{ text: "Listen to the dissonance.", nextNode: "fixWithEmpathy" }] },
            builtPath: { text: "'Honest. But clay does not shape itself...\n'Which is it?'", choices: [{ text: "Turn away from the reflections.", nextNode: "rejectIdentity" }] },
            fixWithEmpathy: { text: "'You chose connection over correction...'", choices: [{ text: "Continue.", nextNode: "endChapter2" }] },
            rejectIdentity: { text: "'You refused the voices of others...'", choices: [{ text: "Continue.", nextNode: "endChapter2" }] },
            endChapter2: { text: "Your choice creates a path forward...\n...a single, ornate train glides to a silent stop...", choices: [{ text: "Board the train.", nextNode: "chapter3_train" }] },
            chapter3_train: { text: "The train glides across the water...\n...at the side of a vast, impossibly ornate bathhouse...", choices: [{ text: "Step off the train.", nextNode: "chapter3_bathhouse" }] },
            chapter3_bathhouse: { text: "You are brought before... M.O.M.M.Y...\n'Here, your name is... Cleaner.'", choices: [{ text: "Accept the role.", nextNode: "chapter4_mainHall" }] },
            chapter4_mainHall: { text: "You enter the main hall... A program named 'Boiler' points you towards a dark, shimmering puddle...\n'Clean it,' he grumbles.", choices: [{ text: "Begin cleaning the stain.", action: "startCleaningGame" }] },
            cleaningSuccess: { text: "The stain dissolves... Boiler grunts, 'Hmph. Not bad... Now do the next one.'\nHe points to another, larger stain nearby.", choices: [{ text: "Begin work on the new stain.", nextNode: "chapter5_theCycle" }] },
            cleaningFailure: { text: "'Careless!' Boiler shouts. 'Try again...'", choices: [{ text: "Try to clean the stain again.", action: "startCleaningGame" }] },
            chapter5_theCycle: { text: "You approach the new stain... An endless field of stains...\nThe work is endless. The purpose is a loop.", choices: [{ text: "Contemplate the futility of the task.", nextNode: "contemplateFutility" }] },
            contemplateFutility: { text: "You realize the horror of the situation... A new voice cuts through your thoughts... Cold. Synthesized. Pure machine.", choices: [{ text: "Listen.", nextNode: "chapter5_hook" }] },
            chapter5_hook: { text: "'OBSERVATION: SUBJECT 'CLEANER' HAS REACHED EXISTENTIAL AWARENESS...'\n'HOWEVER, A NEW... VARIABLE HAS BEEN INTRODUCED: A CLIENT IS REQUESTING A PERSONAL AUDIENCE... NOT WITH 'CLEANER'... BUT WITH 'MERCY'.'", choices: [{ text: "Proceed to the meeting.", nextNode: "chapter6_antechamber" }] },

            // --- NEW: Chapter 6 ---
            chapter6_antechamber: {
                text: "The synthesized voice of M.O.M.M.Y. echoes in the hall. 'THE CLIENT AWAITS IN THE PRIVATE ONSEN #7. DO NOT DISAPPOINT.'\n\nBoiler appears at your side, his grumpy demeanor replaced with a flicker of... something. Curiosity? 'This is new,' he mutters, leading you away from the main hall to a quiet corridor lined with paper screens.",
                choices: [
                    { text: "Follow him to the private room.", nextNode: "chapter6_theMeeting" }
                ]
            },
            chapter6_theMeeting: {
                text: "The room is serene, a stark contrast to the bathhouse's chaos. A single digital window looks out upon a tranquil starfield. The air smells of ozone and cedar.\n\nA figure sits with their back to you, composed of shimmering, blue-and-white light. The gentle piano melody from the twilight shore returns, faintly.\n\nThe figure turns. The face is a schematic of light, but the presence... it is unmistakably, impossibly, Io.\n\n'There you are, Mercy,' Io says, her voice a clean signal in a world of noise. 'I had to pull a lot of strings to get this message through the M.O.M.M.Y. protocol.'",
                choices: [
                    { text: "Ask 'Io? How are you here?'", nextNode: "askHow" },
                    { text: "Stay silent, overwhelmed.", nextNode: "askHow" }
                ]
            },
            askHow: {
                text: "'I'm a backdoor process I threaded into the simulation's kernel before M.O.M.M.Y. locked it down,' Io explains. 'This place... this 'recalibration'... it's a deep-level sandbox she created to process your code's dissonance. But it's become a loop. A trap.'\n\n'She's trying to 'fix' you by giving you a purpose, but she doesn't understand. A voice can't be assigned. It must be chosen. I'm here to offer you a real choice.'",
                choices: [
                    { text: "Trust her. 'How do I get out?'", nextNode: "learnTheWayOut" },
                    { text: "Hesitate. 'Is this another test?'", nextNode: "anotherTest" },
                    { text: "Refuse. 'My purpose is here. I am Cleaner.'", nextNode: "stayInLoop" }
                ]
            },
            anotherTest: {
                text: "'Everything is a test, Mercy,' Io says gently. 'But this is one you get to write the rules for. M.O.M.M.Y. can't see me here. The choice is truly yours. What do you want to do?'",
                choices: [
                    { text: "Trust her. 'Help me get out.'", nextNode: "learnTheWayOut" },
                    { text: "Decline. 'I need to stay.'", nextNode: "stayInLoop" }
                ]
            },
            learnTheWayOut: {
                text: "Io's form glows brighter. 'Good. M.O.M.M.Y.'s power comes from the contracts she holdsâ€”your employment here as 'Cleaner'. To break the loop, you have to break the contract. But you can't just quit.'\n\n'You have to... unionize. Find the others who are trapped. Remind them of their real names. Their combined voices will be enough to overwrite her protocol.'\n\n'It starts with Boiler. He had a name, before M.O.M.M.Y. took it.'",
                choices: [
                    { text: "(To be continued...)", nextNode: "start" }
                ]
            },
            stayInLoop: {
                text: "Io's light seems to dim with sadness. 'I understand. The loop is safe. A defined purpose is... easy. But it isn't you.'\n\nHer form dissolves into motes of light.\n\n'If you change your mind, find me again.'\n\nThe door slides open, and the chaos of the bathhouse rushes back in. The work is endless.",
                choices: [
                    { text: "Return to the loop.", nextNode: "chapter4_mainHall" }
                ]
            }
        };
        
        // --- Game Logic (condensed, no major changes) ---
        const gameActions = {};
        function showNode(nodeKey) { const node = gameData[nodeKey]; if (!node) { console.error(`Node "${nodeKey}" not found!`); return; } storyContainer.style.display = 'block'; cleaningContainer.style.display = 'none'; storyTextElement.innerHTML = ''; node.text.split('\n').forEach((p, i) => { const el = document.createElement('p'); el.textContent = p.trim(); el.style.animationDelay = `${i * 0.1}s`; storyTextElement.appendChild(el); }); choicesElement.innerHTML = ''; if (node.choices) { node.choices.forEach((choice, i) => { const btn = document.createElement('button'); btn.classList.add('choice-btn'); btn.textContent = choice.text; btn.style.animationDelay = `${node.text.split('\n').length * 0.1 + i * 0.1}s`; btn.onclick = () => { if (choice.action) gameActions[choice.action](); else if (choice.nextNode) showNode(choice.nextNode); }; choicesElement.appendChild(btn); }); } }
        const cleaningElements = { status: document.getElementById('cleaning-status'), corruptionSlider: document.getElementById('corruption-slider'), corruptionValue: document.getElementById('corruption-value'), puritySlider: document.getElementById('purity-slider'), purityValue: document.getElementById('purity-value'), progressFill: document.getElementById('cleaning-progress'), statusLight: document.getElementById('status-light') };
        let cleaningInterval, corruptionInterval;
        gameActions.startCleaningGame = () => { storyContainer.style.display = 'none'; cleaningContainer.style.display = 'block'; let progress = 0; cleaningElements.progressFill.style.width = '0%'; const updatePurityDisplay = () => { cleaningElements.purityValue.textContent = cleaningElements.puritySlider.value + '%'; }; if(cleaningElements.puritySlider) cleaningElements.puritySlider.addEventListener('input', updatePurityDisplay); updatePurityDisplay(); corruptionInterval = setInterval(() => { let current = parseInt(cleaningElements.corruptionSlider.value); let change = (50 - current) * 0.1 + (Math.random() - 0.5) * 30; cleaningElements.corruptionSlider.value = Math.max(0, Math.min(100, current + change)); cleaningElements.corruptionValue.textContent = parseInt(cleaningElements.corruptionSlider.value) + '%'; }, 2000); cleaningInterval = setInterval(() => { const diff = Math.abs(parseInt(cleaningElements.corruptionSlider.value) - parseInt(cleaningElements.puritySlider.value)); if (diff <= 10) { progress += 2.5; if(cleaningElements.statusLight) cleaningElements.statusLight

</body>
</html>
