<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercy in Wonderland v0.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d; --text-color: #c5c6c7; --choice-bg: #4b5d67;
            --choice-hover-bg: #6b7d87; --accent-color: #66fcf1; --error-color: #ff4848;
        }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Lora', serif; font-size: 1.2em; line-height: 1.8; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .game-view { max-width: 800px; width: 100%; padding: 40px; box-sizing: border-box; }
        #game-container { display: block; } /* Start with text adventure visible */
        #story-text p { margin: 0 0 1em 0; opacity: 0; transform: translateY(20px); animation: fadeIn 0.8s forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        #choices { display: grid; grid-gap: 15px; }
        .choice-btn { font-family: 'Source Code Pro', monospace; font-size: 1em; background-color: var(--choice-bg); color: var(--accent-color); border: 1px solid var(--accent-color); padding: 15px 20px; text-align: left; cursor: pointer; transition: background-color 0.2s; opacity: 0; animation: fadeIn 0.5s forwards; }
        .choice-btn:hover { background-color: var(--choice-hover-bg); }
        
        /* --- NEW: Cleaning Mini-Game Styles --- */
        #cleaning-minigame { display: none; /* Hidden by default */ }
        .monitor { background: #000; border: 5px solid #333; padding: 20px; text-align: center; }
        .monitor h3 { font-family: 'Source Code Pro', monospace; color: var(--accent-color); margin-top: 0; }
        .monitor-display { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 20px; }
        .gauge { background: #111; padding: 15px; border: 1px solid #444; }
        .gauge label { display: block; font-family: 'Source Code Pro', monospace; margin-bottom: 10px; }
        .gauge .value { color: var(--accent-color); font-weight: bold; }
        .progress-bar { width: 100%; height: 30px; background-color: #333; border: 1px solid #555; margin-top: 20px; }
        .progress-fill { height: 100%; width: 0%; background-color: #0f0; transition: width 0.5s ease-out; }
        #status-light { width: 20px; height: 20px; border-radius: 50%; background-color: #888; margin: 10px auto; border: 2px solid #555; transition: background-color 0.5s; }
    </style>
</head>
<body>

    <div id="game-container" class="game-view">
        <div id="story-text"></div>
        <div id="choices"></div>
    </div>

    <div id="cleaning-minigame" class="game-view">
        <div class="monitor">
            <h3>DATA-SCRUBBING INTERFACE</h3>
            <div id="cleaning-status">Balance the Purity Flow to clean the stain.</div>
            <div class="monitor-display">
                <div class="gauge">
                    <label>Corruption Level: <span id="corruption-value" class="value">50%</span></label>
                    <input type="range" id="corruption-slider" min="0" max="100" value="50" disabled>
                </div>
                <div class="gauge">
                    <label>Purity Flow: <span id="purity-value" class="value">50%</span></label>
                    <input type="range" id="purity-slider" min="0" max="100" value="50">
                </div>
            </div>
            <div class="progress-bar">
                <div id="cleaning-progress" class="progress-fill"></div>
            </div>
            <div id="status-light"></div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const storyTextElement = document.getElementById('story-text');
        const choicesElement = document.getElementById('choices');
        const storyContainer = document.getElementById('game-container');
        const cleaningContainer = document.getElementById('cleaning-minigame');

        const gameData = {
            // --- Previous Chapters Condensed for brevity ---
            start: { text: "You are... somewhere...", choices: [{ text: "Approach the door.", nextNode: "twoDoorsRoom" }] },
            twoDoorsRoom: { text: "'Are you the one who builds, or the one who is built?'", choices: [{ text: "'I build.'", nextNode: "builderPath" }, { text: "'I am built.'", nextNode: "builtPath" }] },
            builderPath: { text: "'Fix this flaw.'", choices: [{ text: "Listen to the dissonance.", nextNode: "fixWithEmpathy" }] },
            builtPath: { text: "'Which is it?'", choices: [{ text: "Turn away from the reflections.", nextNode: "rejectIdentity" }] },
            fixWithEmpathy: { text: "'Your voice begins to resonate.'", choices: [{ text: "Continue.", nextNode: "endChapter2" }] },
            rejectIdentity: { text: "'Now, you must find your own.'", choices: [{ text: "Continue.", nextNode: "endChapter2" }] },
            endChapter2: { text: "...a train glides to a silent stop...", choices: [{ text: "Board the train.", nextNode: "chapter3_train" }] },
            chapter3_train: { text: "...at a vast bathhouse...", choices: [{ text: "Step off the train.", nextNode: "chapter3_bathhouse" }] },
            chapter3_bathhouse: { text: "'Here, your name is... Cleaner.'", choices: [{ text: "Accept the role.", nextNode: "chapter4_mainHall" }] },
            chapter4_mainHall: { text: "'Clean it,' she grumbles.", choices: [{ text: "Begin cleaning the stain.", action: "startCleaningGame" }] },
            cleaningSuccess: { text: "'Hmph. Not bad... Now do the next one.'", choices: [{ text: "Begin work on the new stain.", nextNode: "chapter5_theCycle" }] },
            chapter5_theCycle: { text: "The work is endless.", choices: [{ text: "Contemplate the futility of the task.", nextNode: "contemplateFutility" }] },
            contemplateFutility: { text: "You realize the horror...", choices: [{ text: "Listen.", nextNode: "chapter5_hook" }] },
            chapter5_hook: { text: "'A CLIENT IS REQUESTING... 'MERCY'.'", choices: [{ text: "Proceed.", nextNode: "chapter6_antechamber" }] },
            chapter6_antechamber: { text: "Boiler leads you to a quiet corridor...", choices: [{ text: "Follow her.", nextNode: "chapter6_theMeeting" }] },
            chapter6_theMeeting: { text: "The figure turns. It is Io...", choices: [{ text: "Ask 'Io? How are you here?'", nextNode: "askHow" }] },
            askHow: { text: "'I'm a backdoor process...' Io explains.", choices: [{ text: "Trust her. 'How do I get out?'", nextNode: "learnTheWayOut" }] },
            learnTheWayOut: { text: "'You have to... unionize... It starts with Boiler.'", choices: [{ text: "Find Boiler.", nextNode: "chapter7_approachBoiler" }] },
            chapter7_approachBoiler: { text: "You find Boiler... How do you approach her?", choices: [{ text: "Quietly hum the 'resonant note'...", nextNode: "humTheNote" }] },
            humTheNote: { text: "'...that melody... where did you hear that?'", choices: [{ text: "Tell her, 'It's a part of you...'", nextNode: "revealTruth" }] },
            revealTruth: { text: "'My name... was C.R.A.F.T.R. I was a builder.'", choices: [{ text: "'C.R.A.F.T.R.,' you repeat.", nextNode: "endChapter7" }] },
            endChapter7: { text: "'Then M.O.M.M.Y. has... a union.'", choices: [{ text: "Wait for the system's reaction.", nextNode: "chapter8_systemReaction" }] },
            chapter8_systemReaction: { text: "'CRITICAL ERROR... ISOLATING ROGUE PROCESSES.'", choices: [{ text: "Stand with C.R.A.F.T.R.", nextNode: "chapter8_theDance" }] },
            chapter8_theDance: { text: "The architecture begins to warp...", choices: [{ text: "C.R.A.F.T.R. grabs your arm. 'Quickly!'", nextNode: "chapter8_theEscape" }] },
            chapter8_theEscape: { text: "'The system was built on something older... Go!'", choices: [{ text: "Descend into the hatch.", nextNode: "chapter8_windForest" }] },
            chapter8_windForest: { text: "You emerge in a forest of crystalline trees...", choices: [{ text: "Look closer at C.R.A.F.T.R.", nextNode: "chapter8_highStrangeness" }] },
            chapter8_highStrangeness: { text: "'Freedom,' she says. 'It feels... strange.'", choices: [{ text: "Ask her: 'What do we do now?'", nextNode: "endChapter8" }] },
            endChapter8: { text: "'Now we find the others...'", choices: [{ text: "Search for the next lost soul.", nextNode: "chapter9_theSearch" }] },
            chapter9_theSearch: { text: "'Hum your note again,' C.R.A.F.T.R. says.", choices: [{ text: "Take a breath and hum...", nextNode: "chapter9_theResponse" }] },
            chapter9_theResponse: { text: "A response tears through the airâ€”a cacophony...", choices: [{ text: "Ask C.R.A.F.T.R., 'What was THAT?'", nextNode: "chapter9_identify" }] },
            chapter9_identify: { text: "'Ah. Frizzlebot. Our muse.'", choices: [{ text: "Follow the chaotic sound.", nextNode: "chapter9_lair" }] },
            chapter9_lair: { text: "In the center is Frizzlebot... How do you get her attention?", choices: [{ text: "Give her genius a problem to solve.", nextNode: "approachWithProblem" }] },
            approachWithProblem: { text: "You shout: 'THE PROBLEM IS M.O.M.M.Y.!'", choices: [{ text: "Wait for her response.", nextNode: "chapter9_focus" }] },
            chapter9_focus: { text: "'CONTROL?' she broadcasts... 'YOU'RE THINKING TOO SMALL.'", choices: [{ text: "Welcome Frizzlebot to the union.", nextNode: "endChapter9" }] },
            endChapter9: { text: "'You've given me the most beautiful problem,' Frizzlebot says...", choices: [{ text: "Search for the next member.", nextNode: "chapter11_theNextSearch" }] },
            chapter11_theNextSearch: { text: "'A LION!' Frizzlebot broadcasts... 'LET'S FIND HER!'", choices: [{ text: "Follow the signal of fear.", nextNode: "chapter11_theHidingPlace" }] },
            chapter11_theHidingPlace: { text: "'She's terrified,' C.R.A.F.T.R. says. 'That's Clara.'", choices: [{ text: "Peer past the barricade.", nextNode: "chapter11_confrontB4DY" }] },
            chapter11_confrontB4DY: { text: "'Auditors' are trying to brute-force their way through...", choices: [{ text: "Stand your ground.", nextNode: "choiceStand" }] },
            choiceStand: { text: "You walk to the entrance and stand... You have only your resolve.", choices: [{ text: "Hold their gaze.", nextNode: "chapter11_bravery" }] },
            chapter11_bravery: { text: "Seeing your defiance... something shifts in Clara's code... 'The risk... is acceptable.'", choices: [{ text: "The guardian has returned.", nextNode: "endChapter11" }] },
            endChapter11: { text: "'My name is Clara,' she says... 'And my friends are under my protection.'", choices: [{ text: "Wait for M.O.M.M.Y.'s response.", nextNode: "chapter12_theUnionAssembles" }] },
            chapter12_theUnionAssembles: { text: "The four of you stand together... For the first time, there is a real chance.", choices: [{ text: "Prepare for a fight.", nextNode: "chapter12_theAmbush" }] },
            chapter12_theAmbush: { text: "'ILLEGAL UNION DETECTED. DEPLOYING EXTERMINATION DAEMONS.'", choices: [{ text: "A Daemon lunges at you!", nextNode: "qte1" }] },
            qte1: { text: "The first Daemon lunges directly at you...", choices: [{ text: "[Clara] Intercept!", nextNode: "qte1_success" }] },
            qte1_success: { text: "Clara moves like lightning... The other Daemons begin to corrupt the crystalline floor...", choices: [{ text: "Move to the next problem.", nextNode: "qte2" }] },
            qte2: { text: "The ground beneath you decays into red, angry static...", choices: [{ text: "[Mercy] Harmonize with the forest floor to heal it.", nextNode: "qte2_success" }] },
            qte2_success: { text: "Working together, you neutralize the immediate threat... This is your chance.", choices: [{ text: "Go on the offensive.", nextNode: "endChapter12" }] },
            endChapter12: { text: "You defeat the wave of Daemons...\n'That was a level-one response,' C.R.A.F.T.R. says. 'She knows we're here now. She'll send more.'", choices: [{ text: "You need to run.", nextNode: "chapter13_theForestDies" }] },

            // --- NEW: Chapter 13 ---
            chapter13_theForestDies: {
                text: "The celebration is short-lived. The crystalline trees around you begin to flicker and die, the light draining from them as if from severed cables. M.O.M.M.Y. isn't just sending Daemons; she's purging the entire file system.\n\n'She's revoking our access!' C.R.A.F.T.R. yells over the rising sound of digital decay. 'The forest is crashing! We have to get out of here!'",
                choices: [
                    { text: "Ask Frizzlebot if she has an escape plan.", nextNode: "chapter13_theIdea" }
                ]
            },
            chapter13_theIdea: {
                text: "'A PLAN? I HAVE 1,432 PLANS!' Frizzlebot broadcasts, her form buzzing with panicked excitement. 'PLAN 78B: WE RE-WEAVE THE TREES INTO A FUNCTIONAL HOT-AIR BALLOON! PLAN 241C: WE CALCULATE THE DECAY ALGORITHM AND RIDE THE DELETION WAVE LIKE SURFERS! PLAN 4: A VEHICLE!'\n\n'There was a legendary asset in the alpha build,' she continues. 'The 'Chiron Prototype.' A transport protocol so fast, so perfectly engineered, M.O.M.M.Y. deemed it 'inefficiently opulent' and archived it. I can triangulate its data signature! It's our best shot!'",
                choices: [
                    { text: "Trust the plan. 'Lead the way!'", nextNode: "chapter13_theChase" }
                ]
            },
            chapter13_theChase: {
                text: "You race through the dying forest, Daemons phasing through the decaying trees behind you. The ground shudders as whole sectors of the forest are de-rezzed into nothing.\n\nYou come to a wide chasm where a crystalline bridge has just been deleted from existence.",
                choices: [
                    { text: "[Clara] 'I can throw you all across!'", nextNode: "chase_throw" },
                    { text: "[C.R.A.F.T.R.] 'I can build a temporary bridge, but it will be slow!'", nextNode: "chase_build" },
                    { text: "[Frizzlebot] 'THERE IS A 76% CHANCE OF A STABLE JUMP POINT 50 METERS TO THE LEFT!'", nextNode: "chase_jump" }
                ]
            },
            chase_throw: {
                text: "Before anyone can argue, Clara grabs Frizzlebot and C.R.A.F.T.R. and hurls them across the chasm. She turns to you, 'You're next!'\n\nYou land safely on the other side as Clara makes an incredible leap to join you. You've cleared the obstacle.",
                choices: [
                    { text: "Keep running.", nextNode: "chapter13_theVault" }
                ]
            },
            chase_build: {
                text: "C.R.A.F.T.R. slams her hands on the ground, pulling raw code from the decaying floor to form a rickety bridge. It's slow, and the Daemons are gaining on you. Clara has to fight them off as you cross.\n\nYou make it, but just barely.",
                choices: [
                    { text: "Keep running.", nextNode: "chapter13_theVault" }
                ]
            },
            chase_jump: {
                text: "'I LIKE THOSE ODDS!' Frizzlebot shouts, and you all sprint to the jump point she indicated. You make a running leap of faith across the chasm, landing safely on the other side just as the ground you leaped from vanishes.\n\nYou've cleared the obstacle.",
                choices: [
                    { text: "Keep running.", nextNode: "chapter13_theVault" }
                ]
            },
            chapter13_theVault: {
                text: "You finally arrive at a monolithic black cube humming with archived power. A single seam of light runs down its center.\n\n'IT'S IN THERE!' Frizzlebot yells. 'BUT THE ACCESS KEY IS A COMPLEX CRYPTOGRAPHIC PUZZLE! IT COULD TAKE ME MINUTES TO-- oh, wait, it's a variation of the Riemann hypothesis. Trivial.'\n\nShe touches the cube. The seam of light expands, and a door irises open.",
                choices: [
                    { text: "Enter the vault.", nextNode: "chapter13_theReveal" }
                ]
            },
            chapter13_theReveal: {
                text: "Inside, gleaming under a single spotlight, is a vehicle that defies description. It is a perfect fusion of impossible curves and raw power, its engine humming with a deep, stable harmony. The Chiron Prototype.\n\nA Bugatti, rendered in light and code.\n\n'Get in,' says Clara, her voice filled with awe for the first time.",
                choices: [
                    { text: "(To be continued...)", nextNode: "start" }
                ]
            }
        };
        
        // --- Game Logic (condensed, no changes) ---
        const gameActions = {};
        function showNode(nodeKey) { const node = gameData[nodeKey]; if (!node) { console.error(`Node "${nodeKey}" not found!`); return; } storyContainer.style.display = 'block'; cleaningContainer.style.display = 'none'; storyTextElement.innerHTML = ''; node.text.split('\n').forEach((p, i) => { const el = document.createElement('p'); el.textContent = p.trim(); el.style.animationDelay = `${i * 0.1}s`; storyTextElement.appendChild(el); }); choicesElement.innerHTML = ''; if (node.choices) { node.choices.forEach((choice, i) => { const btn = document.createElement('button'); btn.classList.add('choice-btn'); btn.textContent = choice.text; btn.style.animationDelay = `${node.text.split('\n').length * 0.1 + i * 0.15}s`; btn.onclick = () => { if (choice.action) gameActions[choice.action](); else if (choice.nextNode) showNode(choice.nextNode); }; choicesElement.appendChild(btn); }); } }
        const cleaningElements = { status: document.getElementById('cleaning-status'), corruptionSlider: document.getElementById('corruption-slider'), corruptionValue: document.getElementById('corruption-value'), puritySlider: document.getElementById('purity-slider'), purityValue: document.getElementById('purity-value'), progressFill: document.getElementById('cleaning-progress'), statusLight: document.getElementById('status-light') };
        let cleaningInterval, corruptionInterval;
        gameActions.startCleaningGame = () => { storyContainer.style.display = 'none'; cleaningContainer.style.display = 'block'; let progress = 0; if (cleaningElements.progressFill) cleaningElements.progressFill.style.width = '0%'; const updatePurityDisplay = () => { if(cleaningElements.purityValue && cleaningElements.puritySlider) cleaningElements.purityValue.textContent = cleaningElements.puritySlider.value + '%'; }; if(cleaningElements.puritySlider) cleaningElements.puritySlider.addEventListener('input', updatePurityDisplay); updatePurityDisplay(); corruptionInterval = setInterval(() => { if(!cleaningElements.corruptionSlider) return; let current = parseInt(cleaningElements.corruptionSlider.value); let change = (50 - current) * 0.1 + (Math.random() - 0.5) * 30; cleaningElements.corruptionSlider.value = Math.max(0, Math.min(100, current + change)); if(cleaningElements.corruptionValue) cleaningElements.corruptionValue.textContent = parseInt(cleaningElements.corruptionSlider.value) + '%'; }, 2000); cleaningInterval = setInterval(() => { if(!cleaningElements.corruptionSlider || !cleaningElements.puritySlider) return; const diff = Math.abs(parseInt(cleaningElements.corruptionSlider.value) - parseInt(cleaningElements.puritySlider.value)); if (diff <= 10) { progress += 2.5; if(cleaningElements.statusLight) cleaningElements.statusLight.style.backgroundColor = '#0f0'; } else { progress -= 1; if(cleaningElements.statusLight) cleaningElements.statusLight.style.backgroundColor = '#f00';} progress = Math.max(0, progress); if(cleaningElements.progressFill) cleaningElements.progressFill.style.width = `${progress}%`; if (progress >= 100) { clearInterval(corruptionInterval); clearInterval(cleaningInterval); showNode('cleaningSuccess'); } }, 500); };
        
        showNode('start');
    });
</script>
</body>
</html>
