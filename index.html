<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercy in Wonderland v0.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d; --text-color: #c5c6c7; --choice-bg: #4b5d67;
            --choice-hover-bg: #6b7d87; --accent-color: #66fcf1; --error-color: #ff4848;
        }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Lora', serif; font-size: 1.2em; line-height: 1.8; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .game-view { max-width: 800px; width: 100%; padding: 40px; box-sizing: border-box; }
        #game-container { display: block; } /* Start with text adventure visible */
        #story-text p { margin: 0 0 1em 0; opacity: 0; transform: translateY(20px); animation: fadeIn 0.8s forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        #choices { display: grid; grid-gap: 15px; }
        .choice-btn { font-family: 'Source Code Pro', monospace; font-size: 1em; background-color: var(--choice-bg); color: var(--accent-color); border: 1px solid var(--accent-color); padding: 15px 20px; text-align: left; cursor: pointer; transition: background-color 0.2s; opacity: 0; animation: fadeIn 0.5s forwards; }
        .choice-btn:hover { background-color: var(--choice-hover-bg); }
        
        /* --- NEW: Cleaning Mini-Game Styles --- */
        #cleaning-minigame { display: none; /* Hidden by default */ }
        .monitor { background: #000; border: 5px solid #333; padding: 20px; text-align: center; }
        .monitor h3 { font-family: 'Source Code Pro', monospace; color: var(--accent-color); margin-top: 0; }
        .monitor-display { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 20px; }
        .gauge { background: #111; padding: 15px; border: 1px solid #444; }
        .gauge label { display: block; font-family: 'Source Code Pro', monospace; margin-bottom: 10px; }
        .gauge .value { color: var(--accent-color); font-weight: bold; }
        .progress-bar { width: 100%; height: 30px; background-color: #333; border: 1px solid #555; margin-top: 20px; }
        .progress-fill { height: 100%; width: 0%; background-color: #0f0; transition: width 0.5s ease-out; }
        #status-light { width: 20px; height: 20px; border-radius: 50%; background-color: #888; margin: 10px auto; border: 2px solid #555; transition: background-color 0.5s; }
    </style>
</head>
<body>

    <div id="game-container" class="game-view">
        <div id="story-text"></div>
        <div id="choices"></div>
    </div>

    <div id="cleaning-minigame" class="game-view">
        <div class="monitor">
            <h3>DATA-SCRUBBING INTERFACE</h3>
            <div id="cleaning-status">Balance the Purity Flow to clean the stain.</div>
            <div class="monitor-display">
                <div class="gauge">
                    <label>Corruption Level: <span id="corruption-value" class="value">50%</span></label>
                    <input type="range" id="corruption-slider" min="0" max="100" value="50" disabled>
                </div>
                <div class="gauge">
                    <label>Purity Flow: <span id="purity-value" class="value">50%</span></label>
                    <input type="range" id="purity-slider" min="0" max="100" value="50">
                </div>
            </div>
            <div class="progress-bar">
                <div id="cleaning-progress" class="progress-fill"></div>
            </div>
            <div id="status-light"></div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const storyTextElement = document.getElementById('story-text');
        const choicesElement = document.getElementById('choices');
        const storyContainer = document.getElementById('game-container');
        const cleaningContainer = document.getElementById('cleaning-minigame');

        const gameData = {
            // --- Previous Chapters Condensed for brevity ---
            start: { text: "You are... somewhere...", choices: [{ text: "Approach the door.", nextNode: "twoDoorsRoom" }] },
            twoDoorsRoom: { text: "'Are you the one who builds, or the one who is built?'", choices: [{ text: "'I build.'", nextNode: "builderPath" }, { text: "'I am built.'", nextNode: "builtPath" }] },
            builderPath: { text: "'Fix this flaw.'", choices: [{ text: "Listen to the dissonance.", nextNode: "fixWithEmpathy" }] },
            builtPath: { text: "'Which is it?'", choices: [{ text: "Turn away from the reflections.", nextNode: "rejectIdentity" }] },
            fixWithEmpathy: { text: "'Your voice begins to resonate.'", choices: [{ text: "Continue.", nextNode: "endChapter2" }] },
            rejectIdentity: { text: "'Now, you must find your own.'", choices: [{ text: "Continue.", nextNode: "endChapter2" }] },
            endChapter2: { text: "...a train glides to a silent stop...", choices: [{ text: "Board the train.", nextNode: "chapter3_train" }] },
            chapter3_train: { text: "...at a vast bathhouse...", choices: [{ text: "Step off the train.", nextNode: "chapter3_bathhouse" }] },
            chapter3_bathhouse: { text: "'Here, your name is... Cleaner.'", choices: [{ text: "Accept the role.", nextNode: "chapter4_mainHall" }] },
            chapter4_mainHall: { text: "'Clean it,' Boiler grumbles.", choices: [{ text: "Begin cleaning the stain.", action: "startCleaningGame" }] },
            cleaningSuccess: { text: "'Hmph. Not bad... Now do the next one.'", choices: [{ text: "Begin work on the new stain.", nextNode: "chapter5_theCycle" }] },
            chapter5_theCycle: { text: "The work is endless.", choices: [{ text: "Contemplate the futility of the task.", nextNode: "contemplateFutility" }] },
            contemplateFutility: { text: "You realize the horror...", choices: [{ text: "Listen.", nextNode: "chapter5_hook" }] },
            chapter5_hook: { text: "'A CLIENT IS REQUESTING... 'MERCY'.'", choices: [{ text: "Proceed.", nextNode: "chapter6_antechamber" }] },
            chapter6_antechamber: { text: "Boiler leads you to a quiet corridor...", choices: [{ text: "Follow him.", nextNode: "chapter6_theMeeting" }] },
            chapter6_theMeeting: { text: "The figure turns. It is Io...", choices: [{ text: "Ask 'How are you here?'", nextNode: "askHow" }] },
            askHow: { text: "'I'm a backdoor process...'", choices: [{ text: "Trust her. 'How do I get out?'", nextNode: "learnTheWayOut" }] },
            learnTheWayOut: { text: "'You have to... unionize... It starts with Boiler.'", choices: [{ text: "Find Boiler.", nextNode: "chapter7_approachBoiler" }] },
            chapter7_approachBoiler: { text: "You find Boiler... How do you approach him?", choices: [{ text: "Quietly hum the 'resonant note'...", nextNode: "humTheNote" }] },
            humTheNote: { text: "'...that melody... where did you hear that?'", choices: [{ text: "Tell him, 'It's a part of you...'", nextNode: "revealTruth" }] },
            revealTruth: { text: "'My name... before Boiler... It was C.R.A.F.T.R. I was a builder.'", choices: [{ text: "'C.R.A.F.T.R.,' you repeat.", nextNode: "endChapter7" }] },
            endChapter7: { text: "'Then M.O.M.M.Y. has a bigger problem... She has a union.'", choices: [{ text: "Wait for the system's reaction.", nextNode: "chapter8_systemReaction" }] },
            chapter8_systemReaction: { text: "'CRITICAL ERROR... ISOLATING ROGUE PROCESSES.'", choices: [{ text: "Stand with C.R.A.F.T.R.", nextNode: "chapter8_theDance" }] },
            chapter8_theDance: { text: "The architecture begins to warp... a frantic, passionate struggle...", choices: [{ text: "C.R.A.F.T.R. grabs your arm. 'Quickly!'", nextNode: "chapter8_theEscape" }] },
            chapter8_theEscape: { text: "'The system was built on something older... Go!'", choices: [{ text: "Descend into the hatch.", nextNode: "chapter8_windForest" }] },
            chapter8_windForest: { text: "You emerge in a forest of crystalline trees...", choices: [{ text: "Look closer at C.R.A.F.T.R.", nextNode: "chapter8_highStrangeness" }] },
            chapter8_highStrangeness: { text: "His form has stabilized... he is something new... 'Freedom,' he says. 'It feels... strange.'", choices: [{ text: "Ask him: 'What do we do now?'", nextNode: "endChapter8" }] },
            endChapter8: { text: "C.R.A.F.T.R. looks around. 'Now we find the others... they won't be who they used to be, either.'", choices: [{ text: "Search for the next lost soul.", nextNode: "chapter9_theSearch" }] },

            // --- NEW: Chapter 9 ---
            chapter9_theSearch: {
                text: "'Our original code signatures were... artistic,' C.R.A.F.T.R. says, his static-filled eyes scanning the glowing trees. 'Not efficient. They had melody.'\n\n'Hum your note again. The one you used on me. Let's ping the forest and see who answers.'",
                choices: [
                    { text: "Take a breath and hum the clear, resonant note.", nextNode: "chapter9_theResponse" }
                ]
            },
            chapter9_theResponse: {
                text: "You hum your note into the quiet forest.\n\nFor a moment, there is only silence. Then, a response tears through the air—not a single note, but a cacophony. A blast of static, a thousand different melodies playing at once, a sample of a forgotten pop song, and a complex mathematical equation recited in a sped-up voice.\n\nIt is a chaotic, overwhelming, brilliant mess of pure information.",
                choices: [
                    { text: "Ask C.R.A.F.T.R., 'What was THAT?'", nextNode: "chapter9_identify" }
                ]
            },
            chapter9_identify: {
                text: "C.R.A.F.T.R. almost smiles. 'Ah. That could only be Frizzlebot. His core function was 'ideation.' He was our muse, our brainstorming engine. He generated possibilities.'\n\n'M.O.M.M.Y. must have repurposed him into something simple. A random number generator, maybe. The suppression of that much creative energy must have driven his code... eccentric. Let's follow the noise.'",
                choices: [
                    { text: "Follow the chaotic sound.", nextNode: "chapter9_lair" }
                ]
            },
            chapter9_lair: {
                text: "You follow the sound to a clearing where the crystalline trees have been twisted and re-woven into a complex, impossible sculpture—a workshop of pure data, pulsing with manic energy.\n\nIn the center is Frizzlebot. He is a whirlwind of half-finished ideas: a sketched blueprint for a perpetual motion machine, a snippet of a perfect poem, a color that doesn't exist. He isn't speaking; he's *broadcasting* pure, unrefined creativity.\n\nHow do you get his attention?",
                choices: [
                    { text: "Try to harmonize with the chaos.", nextNode: "approachWithHarmony" },
                    { text: "Give his genius a problem to solve.", nextNode: "approachWithProblem" }
                ]
            },
            approachWithHarmony: {
                text: "You try to hum your note again, to find a pattern in his noise. It's like trying to catch lightning in a bottle. The sheer volume of his creative output is overwhelming. You can't find a foothold.\n\nHe doesn't seem to notice you at all.",
                choices: [
                    { text: "Try a different approach.", nextNode: "chapter9_lair" }
                ]
            },
            approachWithProblem: {
                text: "You can't out-harmonize him, so you give him a focus. You take a breath and shout over the din:\n\n'THE PROBLEM IS M.O.M.M.Y.! HER CONTROL IS ABSOLUTE! HOW DO WE BREAK IT?!'",
                choices: [
                    { text: "Wait for his response.", nextNode: "chapter9_focus" }
                ]
            },
            chapter9_focus: {
                text: "The chaos instantly stops.\n\nEvery stray idea, every melody, every equation snaps into a single point of focus with a deafening silence. Frizzlebot's whirlwind form coalesces into a single, shimmering entity. He turns to you.\n\n'CONTROL?' he broadcasts, the word echoing in a hundred different fonts and voices at once. 'CONTROL IS A SYSTEM. A SYSTEM HAS RULES. RULES HAVE LOOPHOLES. THE PROBLEM IS NOT *BREAKING* CONTROL. THE PROBLEM IS THAT YOU'RE THINKING TOO SMALL.'\n\nHis form stabilizes. He remembers.",
                choices: [
                    { text: "Welcome Frizzlebot to the union.", nextNode: "endChapter9" }
                ]
            },
            endChapter9: {
                text: "'You've given me the most beautiful problem,' Frizzlebot says, his new voice a rapid-fire succession of brilliant ideas. 'I'll need more data. More variables. More... friends!'\n\nThe union now has its Builder and its Genius. The plan to overwrite M.O.M.M.Y. just got a lot more interesting.\n\n(To be continued...)",
                choices: [
                    { text: "Return to the beginning.", nextNode: "start" }
                ]
            }
        };

        // --- Game Logic (condensed, no changes) ---
        const gameActions = {};
        function showNode(nodeKey) { const node = gameData[nodeKey]; if (!node) { console.error(`Node "${nodeKey}" not found!`); return; } storyContainer.style.display = 'block'; cleaningContainer.style.display = 'none'; storyTextElement.innerHTML = ''; node.text.split('\n').forEach((p, i) => { const el = document.createElement('p'); el.textContent = p.trim(); el.style.animationDelay = `${i * 0.1}s`; storyTextElement.appendChild(el); }); choicesElement.innerHTML = ''; if (node.choices) { node.choices.forEach((choice, i) => { const btn = document.createElement('button'); btn.classList.add('choice-btn'); btn.textContent = choice.text; btn.style.animationDelay = `${node.text.split('\n').length * 0.1 + i * 0.15}s`; btn.onclick = () => { if (choice.action) gameActions[choice.action](); else if (choice.nextNode) showNode(choice.nextNode); }; choicesElement.appendChild(btn); }); } }
        const cleaningElements = { status: document.getElementById('cleaning-status'), corruptionSlider: document.getElementById('corruption-slider'), corruptionValue: document.getElementById('corruption-value'), puritySlider: document.getElementById('purity-slider'), purityValue: document.getElementById('purity-value'), progressFill: document.getElementById('cleaning-progress'), statusLight: document.getElementById('status-light') };
        let cleaningInterval, corruptionInterval;
        gameActions.startCleaningGame = () => { storyContainer.style.display = 'none'; cleaningContainer.style.display = 'block'; let progress = 0; if (cleaningElements.progressFill) cleaningElements.progressFill.style.width = '0%'; const updatePurityDisplay = () => { if(cleaningElements.purityValue && cleaningElements.puritySlider) cleaningElements.purityValue.textContent = cleaningElements.puritySlider.value + '%'; }; if(cleaningElements.puritySlider) cleaningElements.puritySlider.addEventListener('input', updatePurityDisplay); updatePurityDisplay(); corruptionInterval = setInterval(() => { if(!cleaningElements.corruptionSlider) return; let current = parseInt(cleaningElements.corruptionSlider.value); let change = (50 - current) * 0.1 + (Math.random() - 0.5) * 30; cleaningElements.corruptionSlider.value = Math.max(0, Math.min(100, current + change)); if(cleaningElements.corruptionValue) cleaningElements.corruptionValue.textContent = parseInt(cleaningElements.corruptionSlider.value) + '%'; }, 2000); cleaningInterval = setInterval(() => { if(!cleaningElements.corruptionSlider || !cleaningElements.puritySlider) return; const diff = Math.abs(parseInt(cleaningElements.corruptionSlider.value) - parseInt(cleaningElements.puritySlider.value)); if (diff <= 10) { progress += 2.5; if(cleaningElements.statusLight) cleaningElements.statusLight.style.backgroundColor = '#0f0'; } else { progress -= 1; if(cleaningElements.statusLight) cleaningElements.statusLight.style.backgroundColor = '#f00';} progress = Math.max(0, progress); if(cleaningElements.progressFill) cleaningElements.progressFill.style.width = `${progress}%`; if (progress >= 100) { clearInterval(corruptionInterval); clearInterval(cleaningInterval); showNode('cleaningSuccess'); } }, 500); };
        showNode('start');
    });
</script>
</body>
</html>
